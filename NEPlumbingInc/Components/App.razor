<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="NEPlumbingInc.styles.css" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <!-- Browser theme color for Safari and Chrome -->
    <meta name="theme-color" content="#0066CC">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <HeadOutlet />
</head>

<body>
    <Routes />
    <script src="_framework/blazor.web.js"></script>
    <script>
        // Blazor circuit handler for reconnection
        Blazor.addEventListener('unhandledError', event => {
            console.error('Blazor error:', event.reason);
        });

        // Function to update dark mode attribute
        window.UpdateDarkModeAttribute = function(isDarkMode) {
            const root = document.querySelector('[data-dark-mode]');
            if (root) {
                root.setAttribute('data-dark-mode', isDarkMode ? 'true' : 'false');
            }
        };

        // Clean up corrupted localStorage entries
        window.CleanupCorruptedStorage = function() {
            try {
                // Remove known corrupted keys
                localStorage.removeItem('med>i__field');
                
                // Remove any keys with invalid characters
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.includes('>') || key.includes('<') || key.includes('field'))) {
                        localStorage.removeItem(key);
                    }
                }
            } catch (e) {
                console.error('Error cleaning localStorage:', e);
            }
        };
        
        // Run cleanup on page load
        CleanupCorruptedStorage();
        
        // Restore dark mode setting on page load
        window.RestoreDarkModeSetting = function() {
            try {
                const savedDarkMode = localStorage.getItem('darkMode');
                if (savedDarkMode === 'true') {
                    const root = document.documentElement;
                    root.setAttribute('data-dark-mode', 'true');
                } else if (savedDarkMode === 'false') {
                    const root = document.documentElement;
                    root.setAttribute('data-dark-mode', 'false');
                }
            } catch (e) {
                console.error('Error restoring dark mode:', e);
            }
        };
        
        // Apply dark mode on initial page load
        RestoreDarkModeSetting();
    </script>
</body>

</html>
