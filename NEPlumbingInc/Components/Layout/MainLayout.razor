@inherits LayoutComponentBase
@inject IColorSettingsService ColorSettingsService
@inject ICareersPageSettingsService CareersPageSettingsService
@using Microsoft.AspNetCore.Components.Authorization

<PageTitle>NE Plumbing Inc.</PageTitle>

<style>
    :root {
        /* Light palette (admin-configurable) */
        --light-primary-color: @(colorSettings?.PrimaryColor ?? "#0066CC");
        --light-secondary-color: @(colorSettings?.SecondaryColor ?? "#005299");
        --light-accent-color: @(colorSettings?.AccentColor ?? "#003d7a");
        --light-text-color: @(colorSettings?.TextColor ?? "#212529");
        --light-bg-color: @(colorSettings?.LightBgColor ?? "#f8f9fa");
        --light-hero-badge-color: @(colorSettings?.HeroBadgeColor ?? "#0056b3");
        --light-button-color: @(colorSettings?.ButtonColor ?? "#0066CC");
        --light-surface-color: @(colorSettings?.SurfaceColor ?? "#ffffff");
        --light-surface-alt-color: @(colorSettings?.SurfaceAltColor ?? "#f8f9fa");
        --light-input-bg-color: @(colorSettings?.InputBgColor ?? "#ffffff");
        --light-header-footer-text-color: @(colorSettings?.HeaderFooterTextColor ?? "#ffffff");

        --site-font-family: @GetFontCssValue(colorSettings?.FontFamily);

        /* Dark palette (admin-configurable) */
        --dark-primary-color: @(colorSettings?.DarkPrimaryColor ?? "#569cd6");
        --dark-secondary-color: @(colorSettings?.DarkSecondaryColor ?? "#4f8cc4");
        --dark-accent-color: @(colorSettings?.DarkAccentColor ?? "#9cdcfe");
        --dark-text-color: @(colorSettings?.DarkTextColor ?? "#d4d4d4");
        --dark-bg-color: @(colorSettings?.DarkBgColor ?? "#1e1e1e");
        --dark-hero-badge-color: @(colorSettings?.DarkHeroBadgeColor ?? "#2d2d30");
        --dark-button-color: @(colorSettings?.DarkButtonColor ?? "#569cd6");
        --dark-surface-color: @(colorSettings?.DarkSurfaceColor ?? "#252526");
        --dark-surface-alt-color: @(colorSettings?.DarkSurfaceAltColor ?? "#2d2d30");
        --dark-input-bg-color: @(colorSettings?.DarkInputBgColor ?? "#3c3c3c");
        --dark-header-footer-text-color: @(colorSettings?.DarkHeaderFooterTextColor ?? "#ffffff");

        /* Active palette (switches with data-dark-mode) */
        --primary-color: var(--light-primary-color);
        --secondary-color: var(--light-secondary-color);
        --accent-color: var(--light-accent-color);
        --text-color: var(--light-text-color);
        --page-bg-color: var(--light-bg-color);
        --hero-badge-color: var(--light-hero-badge-color);
        --button-color: var(--light-button-color);
        --surface-color: var(--light-surface-color);
        --surface-alt-color: var(--light-surface-alt-color);
        --input-bg-color: var(--light-input-bg-color);
        --header-footer-text-color: var(--light-header-footer-text-color);

        --light-border-color: @(colorSettings?.BorderColor ?? "#dee2e6");
        --dark-border-color: @(colorSettings?.DarkBorderColor ?? "#3e3e42");

        --bs-body-bg: var(--page-bg-color);
        --bs-body-color: var(--text-color);
        --bs-border-color: var(--light-border-color);
        --bs-code-color: #e83e8c;
        --bs-heading-color: inherit;
        --bs-link-color: var(--primary-color);
        --bs-link-hover-color: var(--secondary-color);
        --bs-primary: var(--primary-color);
        --bs-secondary: var(--secondary-color);
    }

    :root[data-dark-mode="true"],
    body[data-dark-mode="true"] {
        --primary-color: var(--dark-primary-color);
        --secondary-color: var(--dark-secondary-color);
        --accent-color: var(--dark-accent-color);
        --text-color: var(--dark-text-color);
        --page-bg-color: var(--dark-bg-color);
        --hero-badge-color: var(--dark-hero-badge-color);
        --button-color: var(--dark-button-color);
        --surface-color: var(--dark-surface-color);
        --surface-alt-color: var(--dark-surface-alt-color);
        --input-bg-color: var(--dark-input-bg-color);
        --header-footer-text-color: var(--dark-header-footer-text-color);

        --bs-body-bg: var(--page-bg-color);
        --bs-body-color: var(--text-color);
        --bs-border-color: var(--dark-border-color);
        --bs-link-color: var(--primary-color);
        --bs-link-hover-color: var(--accent-color);
        --bs-primary: var(--primary-color);
        --bs-secondary: var(--secondary-color);
    }

    /* Mode-agnostic rules driven by the active variables.
       These intentionally live *after* the legacy dark-mode overrides to prevent
       palette bleed/mixing and keep one source of truth: the CSS variables. */
    body,
    main,
    .min-vh-100,
    section,
    article {
        background-color: var(--page-bg-color);
        color: var(--text-color);
    }

    body {
        font-family: var(--site-font-family), system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    a {
        color: var(--bs-link-color);
    }

    a:hover {
        color: var(--bs-link-hover-color);
    }

    h1, h2, h3, h4, h5, h6,
    p {
        color: var(--text-color);
    }

    header.navbar,
    header.navbar .navbar-brand,
    header.navbar .nav-link,
    header.navbar a {
        color: var(--header-footer-text-color) !important;
    }

    footer,
    footer h1,
    footer h2,
    footer h3,
    footer h4,
    footer h5,
    footer h6,
    footer p,
    footer a,
    footer small,
    footer .text-white {
        color: var(--header-footer-text-color) !important;
    }

    footer .btn-outline-light {
        color: var(--header-footer-text-color) !important;
        border-color: var(--header-footer-text-color) !important;
    }

    footer .btn-outline-light:hover {
        background-color: var(--header-footer-text-color) !important;
        border-color: var(--header-footer-text-color) !important;
        color: var(--primary-color) !important;
    }

    .btn-primary {
        background-color: var(--button-color);
        border-color: var(--button-color);
        color: #ffffff;
    }

    .btn-primary:hover {
        background-color: var(--button-color);
        border-color: var(--button-color);
        filter: brightness(1.05);
    }

    .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: #ffffff;
    }

    .btn-outline-secondary {
        color: var(--secondary-color);
        border-color: var(--secondary-color);
    }

    .btn-outline-secondary:hover {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        color: #ffffff;
    }

    .btn-light {
        background-color: var(--surface-alt-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
    }

    .btn-light:hover {
        background-color: var(--surface-alt-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
        filter: brightness(1.05);
    }

    [data-dark-mode="true"],
    [data-dark-mode="true"] html,
    [data-dark-mode="true"] body,
    [data-dark-mode="true"] main,
    [data-dark-mode="true"] .min-vh-100,
    [data-dark-mode="true"] section,
    [data-dark-mode="true"] article {
        background-color: var(--page-bg-color) !important;
        color: var(--text-color);
    }

    /* Remove any light backgrounds */
    [data-dark-mode="true"] [class*="bg-light"],
    [data-dark-mode="true"] [class*="bg-white"] {
        background-color: var(--surface-color) !important;
    }

    /* Dark mode - Navigation */
    [data-dark-mode="true"] .navbar,
    [data-dark-mode="true"] .navbar-dark {
        background-color: var(--surface-alt-color) !important;
    }

    [data-dark-mode="true"] .nav-link {
        color: var(--text-color) !important;
    }

    [data-dark-mode="true"] .nav-link:hover {
        color: var(--accent-color) !important;
    }

    /* Dark mode - Content */
    [data-dark-mode="true"] main {
        background-color: var(--page-bg-color);
        color: var(--text-color);
    }

    [data-dark-mode="true"] .container,
    [data-dark-mode="true"] .container-fluid {
        background-color: transparent;
    }

    /* Dark mode - Cards and Panels */
    [data-dark-mode="true"] .card {
        background-color: var(--surface-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
    }

    [data-dark-mode="true"] .card-header {
        background-color: var(--surface-alt-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
    }

    /* Some admin components use Bootstrap's bg-primary/text-white on headers.
       In dark mode that forces an unrelated blue header, so normalize it back to the theme surfaces. */
    [data-dark-mode="true"] .card-header.bg-primary {
        background-color: var(--surface-alt-color) !important;
        color: var(--text-color) !important;
        border-color: var(--bs-border-color) !important;
    }

    [data-dark-mode="true"] .card-header.bg-primary.text-white {
        color: var(--text-color) !important;
    }

    [data-dark-mode="true"] .card-body {
        background-color: var(--surface-color);
        color: var(--text-color);
    }

    [data-dark-mode="true"] .card-footer {
        background-color: var(--surface-alt-color);
        border-color: var(--bs-border-color);
    }

    /* Dark mode - Modals */
    [data-dark-mode="true"] .modal-content {
        background-color: var(--surface-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
    }

    [data-dark-mode="true"] .modal-header {
        background-color: var(--surface-alt-color);
        border-color: var(--bs-border-color);
    }

    [data-dark-mode="true"] .modal-footer {
        background-color: var(--surface-alt-color);
        border-color: var(--bs-border-color);
    }

    /* Dark mode - Forms */
    [data-dark-mode="true"] .form-control,
    [data-dark-mode="true"] .form-select {
        background-color: var(--input-bg-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
    }

    [data-dark-mode="true"] .form-control:focus,
    [data-dark-mode="true"] .form-select:focus {
        background-color: var(--input-bg-color);
        border-color: var(--primary-color);
        color: var(--text-color);
        box-shadow: 0 0 0 0.2rem rgba(86, 156, 214, 0.25);
    }

    [data-dark-mode="true"] .form-label {
        color: var(--text-color);
    }

    [data-dark-mode="true"] .input-group-text {
        background-color: var(--input-bg-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
    }

    /* Mode-aware surfaces (light + dark) */
    .card {
        background-color: var(--surface-color);
        color: var(--text-color);
    }

    .card-header,
    .card-footer,
    .modal-header,
    .modal-footer {
        background-color: var(--surface-alt-color);
        color: var(--text-color);
    }

    .modal-content {
        background-color: var(--surface-color);
        color: var(--text-color);
    }

    .form-control,
    .form-select,
    .input-group-text {
        background-color: var(--input-bg-color);
        color: var(--text-color);
    }

    /* Dark mode - Buttons */
    [data-dark-mode="true"] .btn-primary {
        background-color: var(--button-color);
        border-color: var(--button-color);
        color: #ffffff;
    }

    [data-dark-mode="true"] .btn-primary:hover {
        background-color: var(--button-color);
        border-color: var(--button-color);
        filter: brightness(1.05);
    }

    [data-dark-mode="true"] .btn-secondary {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        color: #ffffff;
    }

    [data-dark-mode="true"] .btn-secondary:hover {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        filter: brightness(1.05);
    }

    [data-dark-mode="true"] .btn-outline-light {
        color: #d4d4d4;
        border-color: #d4d4d4;
    }

    [data-dark-mode="true"] .btn-outline-light:hover {
        background-color: #d4d4d4;
        color: #1e1e1e;
    }

    [data-dark-mode="true"] .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
    }

    [data-dark-mode="true"] .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: #ffffff;
    }

    /* Dark mode - Tables */
    [data-dark-mode="true"] .table {
        color: #d4d4d4;
        border-color: var(--bs-border-color);
    }

    [data-dark-mode="true"] .table-striped > tbody > tr:nth-of-type(odd) {
        background-color: #2d2d30;
    }

    [data-dark-mode="true"] .table-hover > tbody > tr:hover {
        background-color: #3c3c3c;
    }

    [data-dark-mode="true"] .table-bordered,
    [data-dark-mode="true"] .table-bordered > :not(caption) > * {
        border-color: var(--bs-border-color);
    }

    /* Dark mode - Accordions */
    [data-dark-mode="true"] .accordion-button {
        background-color: var(--surface-alt-color);
        color: var(--text-color);
        border-color: var(--bs-border-color);
    }

    [data-dark-mode="true"] .accordion-button::after {
        /* Make the Bootstrap chevron icon visible on dark surfaces */
        filter: invert(1) grayscale(100%);
    }

    [data-dark-mode="true"] .accordion-button:not(.collapsed) {
        background-color: var(--surface-color);
        color: var(--text-color);
        border-color: var(--bs-border-color);
    }

    [data-dark-mode="true"] .accordion-button:focus {
        border-color: var(--primary-color);
        box-shadow: none;
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    [data-dark-mode="true"] .accordion-body {
        background-color: var(--surface-color);
        border-color: var(--bs-border-color);
        color: var(--text-color);
    }

    /* Dark mode - Lists and Text */
    [data-dark-mode="true"] h1,
    [data-dark-mode="true"] h2,
    [data-dark-mode="true"] h3,
    [data-dark-mode="true"] h4,
    [data-dark-mode="true"] h5,
    [data-dark-mode="true"] h6 {
        color: #d4d4d4;
    }

    [data-dark-mode="true"] p {
        color: #d4d4d4;
    }

    [data-dark-mode="true"] .text-muted {
        color: #858585 !important;
    }

    [data-dark-mode="true"] .text-secondary {
        color: #858585 !important;
    }

    /* Dark mode - Links */
    [data-dark-mode="true"] a {
        color: #569cd6;
    }

    [data-dark-mode="true"] a:hover {
        color: #9cdcfe;
    }

    /* Dark mode - Borders and Dividers */
    [data-dark-mode="true"] hr {
        border-color: var(--bs-border-color);
    }

    [data-dark-mode="true"] .border {
        border-color: var(--bs-border-color) !important;
    }

    /* Dark mode - Alerts */
    [data-dark-mode="true"] .alert {
        background-color: #2d2d30;
        border-color: var(--bs-border-color);
        color: #d4d4d4;
    }

    [data-dark-mode="true"] .alert-info {
        background-color: #1e3a4d;
        border-color: #0e639c;
        color: #9cdcfe;
    }

    [data-dark-mode="true"] .alert-warning {
        background-color: #4a3a1a;
        border-color: #ce9178;
        color: #dcdcaa;
    }

    [data-dark-mode="true"] .alert-danger {
        background-color: #4a1f1f;
        border-color: #f48771;
        color: #f48771;
    }

    [data-dark-mode="true"] .alert-success {
        background-color: #1a4d2a;
        border-color: #4ec9b0;
        color: #4ec9b0;
    }

    /* Dark mode - Badges */
    [data-dark-mode="true"] .badge {
        background-color: #4a7ba7;
        color: #e0f0ff;
        font-weight: 500;
    }

    [data-dark-mode="true"] .badge-primary {
        background-color: #0e639c;
        color: #e0f0ff;
    }

    [data-dark-mode="true"] .badge-secondary {
        background-color: #5a7a8a;
        color: #e0f0ff;
    }

    [data-dark-mode="true"] .badge-success {
        background-color: #2d7a3a;
        color: #a0ffa0;
    }

    [data-dark-mode="true"] .badge-danger {
        background-color: #7a3a2a;
        color: #ffa0a0;
    }

    [data-dark-mode="true"] .badge-warning {
        background-color: #7a6a2a;
        color: #ffe0a0;
    }

    [data-dark-mode="true"] .badge-info {
        background-color: #2a6a7a;
        color: #a0e0ff;
    }

    [data-dark-mode="true"] .badge-light {
        background-color: #5a7a8a;
        color: #e0f0ff;
    }

    [data-dark-mode="true"] .badge-dark {
        background-color: #3a4a5a;
        color: #d4d4d4;
    }

    /* Dark mode - Footer */
    [data-dark-mode="true"] footer {
        background-color: #252526 !important;
        color: #d4d4d4;
    }

    [data-dark-mode="true"] footer a {
        color: #569cd6;
    }

    [data-dark-mode="true"] footer a:hover {
        color: #9cdcfe;
    }

    [data-dark-mode="true"] .border-secondary {
        border-color: var(--bs-border-color) !important;
    }

    .navbar-brand {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .nav-link {
        font-size: 1rem;
    }

    /* Ensure navbar displays properly on all browsers */
    header.navbar {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
    }

    /* Dark mode toggle button (no Blazor circuit required) */
    .dark-mode-toggle {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.5rem;
        padding: 0.5rem;
        transition: transform 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: auto;
        position: relative;
        z-index: 11;
    }

    .dark-mode-toggle:hover {
        transform: scale(1.1);
    }

    .dark-mode-toggle:focus {
        outline: 2px solid rgba(255, 255, 255, 0.5);
        outline-offset: 2px;
    }

    /* Show current mode icon:
       - Light mode => sun
       - Dark mode  => moon */
    .dark-mode-icon-sun {
        display: inline-block;
    }

    .dark-mode-icon-moon {
        display: none;
    }

    [data-dark-mode="true"] .dark-mode-icon-sun {
        display: none;
    }

    [data-dark-mode="true"] .dark-mode-icon-moon {
        display: inline-block;
    }
</style>

<div class="min-vh-100 d-flex flex-column">
    <header class="navbar navbar-expand-lg navbar-dark w-100" style="background-color: var(--primary-color); padding: 0.5rem 1rem;">
        <!-- Company Name -->
        <a class="navbar-brand flex-shrink-0" href="">NE Plumbing Inc.</a>

        <!-- Center Nav Links -->
        <div class="d-flex navbar-nav-center ms-3">
            <NavLink class="nav-link text-white me-3" href="" Match="NavLinkMatch.All">
                <span class="oi oi-home" aria-hidden="true"></span> Home
            </NavLink>
            <NavLink class="nav-link text-white me-3" href="services">
                <span class="oi oi-plus" aria-hidden="true"></span> Services
            </NavLink>
        </div>

        <!-- Right Side Login/Logout & Dark Mode -->
        <div class="d-flex navbar-controls ms-auto">
            <button class="dark-mode-toggle" type="button" onclick="window.ToggleDarkMode && window.ToggleDarkMode()" title="Toggle dark mode">
                <i class="fas fa-moon dark-mode-icon-moon" aria-hidden="true"></i>
                <i class="fas fa-sun dark-mode-icon-sun" aria-hidden="true"></i>
            </button>
            <AuthorizeView Roles="Admin">
                <Authorized Context="auth">
                    <div class="d-flex align-items-center gap-2">
                        <NavLink class="nav-link text-white" href="admin-dashboard">
                            <span class="oi oi-account-logout" aria-hidden="true"></span> @auth.User.Identity?.Name's dashboard
                        </NavLink>
                        <NavLink class="nav-link text-white" href="/auth/logout">
                            <span class="oi oi-account-logout" aria-hidden="true"></span> Logout
                        </NavLink>
                    </div>
                </Authorized>
                <NotAuthorized>
                    <NavLink class="nav-link text-white" href="/account/login">
                        <span class="oi oi-account-login" aria-hidden="true"></span> Admin Login
                    </NavLink>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </header>

    <main class="container my-4 flex-grow-1">
        @Body
    </main>

    <footer class="text-white py-4 mt-auto" style="background-color: var(--primary-color);">
        <div class="container">
            <div class="row text-center text-md-start">
                <!-- About -->
                <div class="col-md-4 mb-3">
                    <h5>About Us</h5>
                    <p class="mb-0">NE Plumbing Inc. brings 20+ years of experience in residential, commercial, and luxury
                        plumbing. We’re proud to serve all of Utah with expert service and professionalism.</p>
                </div>

                <!-- Now Hiring -->
                @if (careersSettings?.IsHiringEnabled ?? true)
                {
                    <div class="col-md-4 mb-3">
                        <h5>Now Hiring</h5>
                        <p class="mb-1">We're looking for skilled plumbers to join our team!</p>
                        <a href="/careers" class="btn btn-outline-light btn-sm">Apply Now</a>
                    </div>
                }

                <!-- Connect -->
                <div class="col-md-4 mb-3">
                    <h5>Connect With Us</h5>

                    <p class="mb-1">
                        <a href="https://www.instagram.com/neplumbinginc" target="_blank" rel="noopener noreferrer"
                            class="text-white text-decoration-none">
                            <i class="fab fa-instagram fa-lg me-2"></i>Instagram
                        </a>
                    </p>

                    <p class="mb-1">
                        <a href="tel:8016413246" class="text-white text-decoration-none">
                            <i class="fas fa-phone fa-sm me-2"></i>(801) 641-3246
                        </a>
                    </p>

                    <p class="mb-0">
                        <a href="mailto:neplumbinginc@gmail.com" class="text-white text-decoration-none">
                            <i class="fas fa-envelope fa-sm me-2"></i>neplumbinginc@gmail.com
                        </a>
                    </p>

                    <!-- Added Contact Us Link -->
                    <p class="mt-3">
                        <a href="/messages" class="btn btn-outline-light btn-sm">Contact Us</a>
                    </p>
                </div>
            </div>

            <hr class="border-secondary" />

            <div class="text-center small">
                &copy; @(DateTime.Now.Year) NE Plumbing Inc. All rights reserved.
            </div>
        </div>
    </footer>
</div>

@code {
    private ColorSettings? colorSettings;
    private CareersPageSettings? careersSettings;

    private static string GetFontCssValue(string? fontFamily)
    {
        // CSS value (include quotes when needed)
        return (fontFamily ?? "Inter") switch
        {
            "Inter" => "'Inter'",
            "Manrope" => "'Manrope'",
            "Nunito Sans" => "'Nunito Sans'",
            "Plus Jakarta Sans" => "'Plus Jakarta Sans'",
            "Poppins" => "'Poppins'",
            "Montserrat" => "'Montserrat'",
            "Merriweather" => "'Merriweather'",
            "Roboto Slab" => "'Roboto Slab'",
            "Raleway" => "'Raleway'",
            "DM Sans" => "'DM Sans'",
            "Rubik" => "'Rubik'",
            "Work Sans" => "'Work Sans'",
            "Figtree" => "'Figtree'",
            "Oswald" => "'Oswald'",
            "Quicksand" => "'Quicksand'",
            "Space Grotesk" => "'Space Grotesk'",
            "Playfair Display" => "'Playfair Display'",
            "Lora" => "'Lora'",
            _ => "'Inter'",
        };
    }

    protected override async Task OnInitializedAsync()
    {
        // Load color settings (server-side)
        colorSettings = await ColorSettingsService.GetColorSettingsAsync();

        // Load Careers page settings (server-side)
        careersSettings = await CareersPageSettingsService.GetSettingsAsync();
    }
}
