@inherits LayoutComponentBase
@inject DarkModeService DarkModeService
@inject IColorSettingsService ColorSettingsService
@implements IAsyncDisposable

<PageTitle>N.E. Plumbing Inc.</PageTitle>

<style>
    :root {
        --bs-body-bg: #ffffff;
        --bs-body-color: #212529;
        --primary-color: @(colorSettings?.PrimaryColor ?? "#0066CC");
        --secondary-color: @(colorSettings?.SecondaryColor ?? "#005299");
        --accent-color: @(colorSettings?.AccentColor ?? "#003d7a");
        --text-color: @(colorSettings?.TextColor ?? "#212529");
        --light-bg-color: @(colorSettings?.LightBgColor ?? "#f8f9fa");
        --hero-badge-color: @(colorSettings?.HeroBadgeColor ?? "#0056b3");
        --button-color: @(colorSettings?.ButtonColor ?? "#0066CC");
        --bs-border-color: #dee2e6;
        --bs-code-color: #e83e8c;
        --bs-heading-color: inherit;
        --bs-link-color: #0066CC;
        --bs-link-hover-color: #0052a3;
    }

    [data-dark-mode="true"] {
        --bs-body-bg: #1a1a1a;
        --bs-body-color: #e0e0e0;
        --bs-border-color: #444;
        --bs-link-color: #4da6ff;
        --bs-link-hover-color: #80bfff;
    }

    [data-dark-mode="true"] body {
        background-color: #1a1a1a;
        color: #e0e0e0;
    }

    /* Dark mode - Navigation */
    [data-dark-mode="true"] .navbar,
    [data-dark-mode="true"] .navbar-dark {
        background-color: #0052a3 !important;
    }

    [data-dark-mode="true"] .nav-link {
        color: #e0e0e0 !important;
    }

    [data-dark-mode="true"] .nav-link:hover {
        color: #4da6ff !important;
    }

    /* Dark mode - Content */
    [data-dark-mode="true"] main {
        background-color: #1a1a1a;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .container,
    [data-dark-mode="true"] .container-fluid {
        background-color: transparent;
    }

    /* Dark mode - Cards and Panels */
    [data-dark-mode="true"] .card {
        background-color: #2a2a2a;
        border-color: #444;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .card-header {
        background-color: #252525;
        border-color: #444;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .card-body {
        background-color: #2a2a2a;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .card-footer {
        background-color: #252525;
        border-color: #444;
    }

    /* Dark mode - Modals */
    [data-dark-mode="true"] .modal-content {
        background-color: #2a2a2a;
        border-color: #444;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .modal-header {
        background-color: #252525;
        border-color: #444;
    }

    [data-dark-mode="true"] .modal-footer {
        background-color: #252525;
        border-color: #444;
    }

    /* Dark mode - Forms */
    [data-dark-mode="true"] .form-control,
    [data-dark-mode="true"] .form-select {
        background-color: #3a3a3a;
        border-color: #555;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .form-control:focus,
    [data-dark-mode="true"] .form-select:focus {
        background-color: #3a3a3a;
        border-color: #4da6ff;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .form-label {
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .input-group-text {
        background-color: #3a3a3a;
        border-color: #555;
        color: #e0e0e0;
    }

    /* Dark mode - Buttons */
    [data-dark-mode="true"] .btn-primary {
        background-color: #0052a3;
        border-color: #0052a3;
    }

    [data-dark-mode="true"] .btn-primary:hover {
        background-color: #0066cc;
        border-color: #0066cc;
    }

    [data-dark-mode="true"] .btn-secondary {
        background-color: #444;
        border-color: #555;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .btn-secondary:hover {
        background-color: #555;
        border-color: #666;
    }

    [data-dark-mode="true"] .btn-outline-light {
        color: #e0e0e0;
        border-color: #e0e0e0;
    }

    [data-dark-mode="true"] .btn-outline-light:hover {
        background-color: #e0e0e0;
        color: #1a1a1a;
    }

    [data-dark-mode="true"] .btn-outline-primary {
        color: #4da6ff;
        border-color: #4da6ff;
    }

    [data-dark-mode="true"] .btn-outline-primary:hover {
        background-color: #4da6ff;
        border-color: #4da6ff;
        color: #1a1a1a;
    }

    /* Dark mode - Tables */
    [data-dark-mode="true"] .table {
        color: #e0e0e0;
        border-color: #444;
    }

    [data-dark-mode="true"] .table-striped > tbody > tr:nth-of-type(odd) {
        background-color: #2a2a2a;
    }

    [data-dark-mode="true"] .table-hover > tbody > tr:hover {
        background-color: #333;
    }

    [data-dark-mode="true"] .table-bordered,
    [data-dark-mode="true"] .table-bordered > :not(caption) > * {
        border-color: #444;
    }

    /* Dark mode - Accordions */
    [data-dark-mode="true"] .accordion-button {
        background-color: #3a3a3a;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .accordion-button:not(.collapsed) {
        background-color: #4a4a4a;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .accordion-button:focus {
        border-color: #4da6ff;
        box-shadow: 0 0 0 0.25rem rgba(77, 166, 255, 0.25);
    }

    [data-dark-mode="true"] .accordion-body {
        background-color: #2a2a2a;
        border-color: #444;
    }

    /* Dark mode - Lists and Text */
    [data-dark-mode="true"] h1,
    [data-dark-mode="true"] h2,
    [data-dark-mode="true"] h3,
    [data-dark-mode="true"] h4,
    [data-dark-mode="true"] h5,
    [data-dark-mode="true"] h6 {
        color: #e0e0e0;
    }

    [data-dark-mode="true"] p {
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .text-muted {
        color: #999 !important;
    }

    [data-dark-mode="true"] .text-secondary {
        color: #999 !important;
    }

    /* Dark mode - Links */
    [data-dark-mode="true"] a {
        color: #4da6ff;
    }

    [data-dark-mode="true"] a:hover {
        color: #80bfff;
    }

    /* Dark mode - Borders and Dividers */
    [data-dark-mode="true"] hr {
        border-color: #444;
    }

    [data-dark-mode="true"] .border {
        border-color: #444 !important;
    }

    /* Dark mode - Alerts */
    [data-dark-mode="true"] .alert {
        background-color: #2a2a2a;
        border-color: #444;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] .alert-info {
        background-color: #1a3a4a;
        border-color: #0052a3;
        color: #4da6ff;
    }

    [data-dark-mode="true"] .alert-warning {
        background-color: #4a3a1a;
        border-color: #cc8800;
        color: #ffcc00;
    }

    [data-dark-mode="true"] .alert-danger {
        background-color: #4a1a1a;
        border-color: #cc0000;
        color: #ff6666;
    }

    [data-dark-mode="true"] .alert-success {
        background-color: #1a4a2a;
        border-color: #00cc00;
        color: #66ff66;
    }

    /* Dark mode - Badges */
    [data-dark-mode="true"] .badge {
        background-color: #4a4a4a;
        color: #e0e0e0;
    }

    /* Dark mode - Footer */
    [data-dark-mode="true"] footer {
        background-color: #0052a3 !important;
        color: #e0e0e0;
    }

    [data-dark-mode="true"] footer a {
        color: #4da6ff;
    }

    [data-dark-mode="true"] footer a:hover {
        color: #80bfff;
    }

    [data-dark-mode="true"] .border-secondary {
        border-color: #444 !important;
    }

    .navbar-brand {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .nav-link {
        font-size: 1rem;
    }

    /* Ensure navbar displays properly on all browsers */
    header.navbar {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
    }
</style>

<div class="min-vh-100 d-flex flex-column" data-dark-mode="@DarkModeService.IsDarkMode.ToString().ToLower()">
    <header class="navbar navbar-expand-lg navbar-dark w-100" style="background-color: var(--primary-color); padding: 0.5rem 1rem;">
        <!-- Company Name -->
        <a class="navbar-brand flex-shrink-0" href="">N.E. Plumbing Inc.</a>

        <!-- Center Nav Links -->
        <div class="d-flex navbar-nav-center ms-3">
            <NavLink class="nav-link text-white me-3" href="" Match="NavLinkMatch.All">
                <span class="oi oi-home" aria-hidden="true"></span> Home
            </NavLink>
            <NavLink class="nav-link text-white me-3" href="services">
                <span class="oi oi-plus" aria-hidden="true"></span> Services
            </NavLink>
        </div>

        <!-- Right Side Login/Logout & Dark Mode -->
        <div class="d-flex navbar-controls ms-auto">
            <DarkModeToggle />
            <AuthorizeView Roles="Admin">
                <Authorized Context="auth">
                    <div class="d-flex align-items-center gap-2">
                        <NavLink class="nav-link text-white" href="admin-dashboard">
                            <span class="oi oi-account-logout" aria-hidden="true"></span> @auth.User.Identity?.Name's dashboard
                        </NavLink>
                        <NavLink class="nav-link text-white" href="/auth/logout">
                            <span class="oi oi-account-logout" aria-hidden="true"></span> Logout
                        </NavLink>
                    </div>
                </Authorized>
                <NotAuthorized>
                    <NavLink class="nav-link text-white" href="/account/login">
                        <span class="oi oi-account-login" aria-hidden="true"></span> Admin Login
                    </NavLink>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </header>

    <main class="container my-4 flex-grow-1">
        @Body
    </main>

    <footer class="text-white py-4 mt-auto" style="background-color: var(--primary-color);">
        <div class="container">
            <div class="row text-center text-md-start">
                <!-- About -->
                <div class="col-md-4 mb-3">
                    <h5>About Us</h5>
                    <p class="mb-0">N.E. Plumbing Inc. brings 20+ years of experience in residential, commercial, and luxury
                        plumbing. We’re proud to serve all of Utah with expert service and professionalism.</p>
                </div>

                <!-- Now Hiring -->
                <div class="col-md-4 mb-3">
                    <h5>Now Hiring</h5>
                    <p class="mb-1">We're looking for skilled plumbers to join our team!</p>
                    <a href="/messages" class="btn btn-outline-light btn-sm">Apply Now</a>
                </div>

                <!-- Connect -->
                <div class="col-md-4 mb-3">
                    <h5>Connect With Us</h5>

                    <p class="mb-1">
                        <a href="https://www.instagram.com/neplumbinginc" target="_blank" rel="noopener noreferrer"
                            class="text-white text-decoration-none">
                            <i class="fab fa-instagram fa-lg me-2"></i>Instagram
                        </a>
                    </p>

                    <p class="mb-1">
                        <a href="tel:8016413246" class="text-white text-decoration-none">
                            <i class="fas fa-phone fa-sm me-2"></i>(801) 641-3246
                        </a>
                    </p>

                    <p class="mb-0">
                        <a href="mailto:neplumbinginc@gmail.com" class="text-white text-decoration-none">
                            <i class="fas fa-envelope fa-sm me-2"></i>neplumbinginc@gmail.com
                        </a>
                    </p>

                    <!-- Added Contact Us Link -->
                    <p class="mt-3">
                        <a href="/messages" class="btn btn-outline-light btn-sm">Contact Us</a>
                    </p>
                </div>
            </div>

            <hr class="border-secondary" />

            <div class="text-center small">
                &copy; @(DateTime.Now.Year) N.E. Plumbing Inc. All rights reserved.
            </div>
        </div>
    </footer>
</div>

@code {
    private ColorSettings? colorSettings;
    private bool initialized = false;

    protected override async Task OnInitializedAsync()
    {
        // Load color settings (no JS interop)
        colorSettings = await ColorSettingsService.GetColorSettingsAsync();
        DarkModeService.OnDarkModeChanged += OnDarkModeChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !initialized)
        {
            initialized = true;
            // Load dark mode preference from localStorage (JS interop only works here)
            string? darkModeValue = await JS.InvokeAsync<string?>("localStorage.getItem", "darkMode");
            bool isDarkMode = darkModeValue == "true";
            DarkModeService.Initialize(isDarkMode);
            StateHasChanged();
        }
    }

    private void OnDarkModeChanged(bool isDarkMode)
    {
        StateHasChanged();
    }

    [Inject]
    private IJSRuntime JS { get; set; } = null!;

    ValueTask IAsyncDisposable.DisposeAsync()
    {
        DarkModeService.OnDarkModeChanged -= OnDarkModeChanged;
        return ValueTask.CompletedTask;
    }
}