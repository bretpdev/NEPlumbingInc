@inject IColorSettingsService ColorSettingsService
@inject ICareersPageSettingsService CareersPageSettingsService
@inject IJSRuntime JS
@rendermode InteractiveServer

<style>
    .color-picker-group {
        display: flex;
        align-items: flex-end;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .color-input-wrapper {
        flex: 1;
    }

    .color-input-wrapper label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .color-input {
        width: 100%;
        height: 50px;
        border: 2px solid #dee2e6;
        border-radius: 0.375rem;
        cursor: pointer;
    }

    .color-input:hover {
        border-color: #0066CC;
    }

    .color-preview {
        display: inline-block;
        width: 40px;
        height: 40px;
        border-radius: 0.375rem;
        border: 2px solid #dee2e6;
        margin-left: 0.5rem;
    }

    .preview-section {
        margin-top: 2rem;
        padding: 2rem;
        border-radius: 0.5rem;
        background-color: #f8f9fa;
    }

    .preview-section[data-dark-mode="true"] {
        background-color: #2a2a2a;
    }

    .preview-btn {
        padding: 0.5rem 1rem;
        margin: 0.5rem;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        font-weight: 500;
    }

    .preview-card {
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 0.375rem;
        border: 1px solid #dee2e6;
        background-color: white;
    }

    .preview-card[data-dark-mode="true"] {
        background-color: #3a3a3a;
        border-color: #555;
    }

    .theme-preview {
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        overflow: hidden;
        background: var(--page-bg-color);
        color: var(--text-color);
        font-family: var(--site-font-family), system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    .theme-preview .min-vh-100 {
        min-height: 0 !important;
    }

    .theme-preview .preview-navbar .brand {
        font-weight: 700;
    }

    .theme-preview .preview-navbar .nav-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .theme-preview .preview-content {
        padding: 1rem;
    }

    .theme-preview .preview-surface {
        background: var(--surface-color);
        border: 1px solid var(--bs-border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .theme-preview .preview-badge {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        background: var(--hero-badge-color);
        color: #fff;
        font-weight: 600;
        margin-left: 0.5rem;
    }

    .theme-preview .preview-link {
        color: var(--bs-link-color);
        text-decoration: underline;
    }

    .theme-preview .preview-link:hover {
        color: var(--bs-link-hover-color);
    }

    .theme-preview .preview-btn-primary {
        background: var(--button-color);
        border: 1px solid var(--button-color);
        color: #fff;
        border-radius: 0.375rem;
        padding: 0.4rem 0.75rem;
        font-weight: 600;
    }

    .theme-preview .preview-btn-outline {
        background: transparent;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
        border-radius: 0.375rem;
        padding: 0.4rem 0.75rem;
        font-weight: 600;
    }

    .theme-preview .preview-input {
        width: 100%;
        background: var(--input-bg-color);
        border: 1px solid var(--bs-border-color);
        color: var(--text-color);
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
    }
</style>

@if (colorSettings != null)
{
    <div class="card shadow-sm mb-3" style="@GetAdminFontStyle()">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-font me-2"></i>Typography</h5>
        </div>
        <div class="card-body">
            <div class="mb-2">
                <label id="fontFamilyLabel" class="form-label">Site Font</label>
                <div class="dropdown w-100">
                    <button type="button"
                            class="btn btn-outline-secondary dropdown-toggle w-100 d-flex justify-content-between align-items-center"
                            aria-haspopup="true"
                            aria-expanded="@(showFontMenu ? "true" : "false")"
                            aria-labelledby="fontFamilyLabel"
                            @onclick="ToggleFontMenu">
                        <span style="@GetFontOptionStyle(colorSettings.FontFamily)">@(colorSettings.FontFamily)</span>
                    </button>

                    <div class="dropdown-menu @(showFontMenu ? "show" : "") w-100" style="max-height: 280px; overflow: auto;">
                        @foreach (var font in AvailableFonts)
                        {
                            <button type="button"
                                    class="dropdown-item"
                                    style="@GetFontOptionStyle(font)"
                                    @onclick="() => SelectFontAsync(font)">
                                @font
                            </button>
                        }
                    </div>
                </div>
                <small class="text-muted">Updates this page immediately (including header/footer) so you can preview. Use <strong>Save Font</strong> to apply site-wide.</small>

                <div class="mt-1 small text-muted">
                    <div>Selected: <strong>@(colorSettings.FontFamily)</strong></div>
                    @if (isFontLoaded is true)
                    {
                        <div>Font file loaded: <strong>Yes</strong></div>
                    }
                    else if (isFontLoaded is false)
                    {
                        <div>Font file loaded: <strong>No</strong> (likely blocked; check network/adblock/CSP for fonts.googleapis.com + fonts.gstatic.com)</div>
                    }
                    else
                    {
                        <div>Font file loaded: <strong>Unknown</strong> (browser doesn’t support detection)</div>
                    }
                </div>
            </div>

            <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-primary" @onclick="SaveFont">
                    <i class="fas fa-save me-2"></i>Save Font
                </button>
            </div>

            <div class="mt-3 p-3 rounded" style="background: var(--surface-color); border: 1px solid var(--bs-border-color); color: var(--text-color);">
                <div class="d-flex flex-wrap align-items-end gap-3">
                    <div style="font-size: 3rem; line-height: 1; font-weight: 700;">Aa</div>
                    <div>
                        <div class="fw-semibold" style="font-size: 1.25rem;">NE Plumbing Inc. — Typography Preview</div>
                        <div class="text-muted">The quick brown fox jumps over the lazy dog. 0123456789</div>
                    </div>
                </div>

                <hr style="border-color: var(--bs-border-color);" />

                <p class="mb-2">
                    This is sample body text to help you compare readability and personality.
                    Here’s a <a href="javascript:void(0)" style="color: var(--bs-link-color);">link</a> and a few UI elements:
                </p>

                <div class="d-flex flex-wrap gap-2">
                    <button type="button" class="btn btn-primary btn-sm">Primary</button>
                    <button type="button" class="btn btn-outline-primary btn-sm">Outline</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm">Secondary</button>
                </div>
            </div>

            @if (!string.IsNullOrEmpty(fontMessage))
            {
                <div class="alert alert-success mt-3" role="alert">
                    @fontMessage
                </div>
            }
        </div>
    </div>

    <div class="card shadow-sm" style="@GetAdminFontStyle()">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-palette me-2"></i>Manage Site Fonts &amp; Colors</h5>
        </div>
        <div class="card-body">
            <form @onsubmit="SaveColors" @onsubmit:preventDefault="true">

                <ul class="nav nav-tabs mb-3">
                    <li class="nav-item">
                        <button type="button"
                                class="nav-link @(activePalette == "light" ? "active" : "")"
                                @onclick="SetLightPalette">
                            Light
                        </button>
                    </li>
                    <li class="nav-item">
                        <button type="button"
                                class="nav-link @(activePalette == "dark" ? "active" : "")"
                                @onclick="SetDarkPalette">
                            Dark
                        </button>
                    </li>
                </ul>

                <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
                    <div>
                        <small class="text-muted d-block">@(activePalette == "light" ? "Light" : "Dark") preset</small>
                        <select class="form-select form-select-sm" style="min-width: 220px" @bind="selectedPresetId">
                            @foreach (var preset in GetPresetsForActivePalette())
                            {
                                <option value="@preset.Id">@preset.Name</option>
                            }
                        </select>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary" @onclick="ApplySelectedPreset">
                        Apply preset
                    </button>
                </div>

                <div class="alert alert-info py-2" role="alert">
                    <small>
                        Each color picker includes a small example of where that color is used (badge, button, cards, header/footer, inputs, etc.).
                        The Live Preview below still shows the full page.
                    </small>
                </div>

                @if (activePalette == "light")
                {
                    <h6 class="mb-3">Light Mode Palette</h6>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="border rounded p-3 mb-3">
                                <label for="primaryColor" class="form-label fw-semibold mb-0">Links/Highlights (also Hero badge)</label>
                                <small class="text-muted d-block mb-2">Used for link color, accents, and the hero badge color.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="primaryColor" @bind="colorSettings.PrimaryColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="primaryColorHex">Hex</label>
                                        <input id="primaryColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.PrimaryColor" placeholder="#0066CC" />
                                    </div>
                                </div>
                                <div class="mt-2 d-flex flex-wrap align-items-center gap-2">
                                    <a href="javascript:void(0)" style="color:@colorSettings.PrimaryColor; text-decoration:underline;">Link preview</a>
                                    <span class="rounded-pill px-2 py-1" style="background:@colorSettings.PrimaryColor; color:#fff; font-weight:600;">Hero badge</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="headerFooterBgColor" class="form-label fw-semibold mb-0">Header/Footer Background</label>
                                <small class="text-muted d-block mb-2">Used for the navbar and footer background color.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="headerFooterBgColor" @bind="colorSettings.HeaderFooterBgColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="headerFooterBgColorHex">Hex</label>
                                        <input id="headerFooterBgColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.HeaderFooterBgColor" placeholder="#0066CC" />
                                    </div>
                                </div>
                                <div class="mt-2 d-flex flex-wrap align-items-center gap-2">
                                    <span class="rounded px-2 py-1" style="background:@colorSettings.HeaderFooterBgColor; color:@colorSettings.HeaderFooterTextColor; font-weight:600;">Header/Footer</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="secondaryColor" class="form-label fw-semibold mb-0">Secondary Color</label>
                                <small class="text-muted d-block mb-2">Used for secondary accents and UI emphasis.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="secondaryColor" @bind="colorSettings.SecondaryColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="secondaryColorHex">Hex</label>
                                        <input id="secondaryColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.SecondaryColor" placeholder="#005299" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="rounded-pill px-2 py-1" style="background:@colorSettings.SecondaryColor; color:#fff; font-weight:600;">Secondary</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="accentColor" class="form-label fw-semibold mb-0">Accent Color</label>
                                <small class="text-muted d-block mb-2">Used for smaller accents, callouts, and decorative highlights.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="accentColor" @bind="colorSettings.AccentColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="accentColorHex">Hex</label>
                                        <input id="accentColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.AccentColor" placeholder="#003d7a" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="rounded-pill px-2 py-1" style="background:@colorSettings.AccentColor; color:#fff; font-weight:600;">Accent</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="textColor" class="form-label fw-semibold mb-0">Text Color</label>
                                <small class="text-muted d-block mb-2">Default text color used across most pages and cards.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="textColor" @bind="colorSettings.TextColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="textColorHex">Hex</label>
                                        <input id="textColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.TextColor" placeholder="#212529" />
                                    </div>
                                </div>
                                <div class="mt-2 small" style="color:@colorSettings.TextColor;">
                                    Sample text preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="bgColor" class="form-label fw-semibold mb-0">Background Color</label>
                                <small class="text-muted d-block mb-2">Main page background behind everything.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="bgColor" @bind="colorSettings.LightBgColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="bgColorHex">Hex</label>
                                        <input id="bgColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.LightBgColor" placeholder="#f8f9fa" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="background:@colorSettings.LightBgColor; border:1px solid @colorSettings.BorderColor; color:@colorSettings.TextColor;">
                                    Page background preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="buttonColor" class="form-label fw-semibold mb-0">Button Color</label>
                                <small class="text-muted d-block mb-2">Primary button background color.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="buttonColor" @bind="colorSettings.ButtonColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="buttonColorHex">Hex</label>
                                        <input id="buttonColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.ButtonColor" placeholder="#0066CC" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <button type="button" class="btn btn-sm" style="background:@colorSettings.ButtonColor; border-color:@colorSettings.ButtonColor; color:#fff; font-weight:600;">Button</button>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="surfaceColor" class="form-label fw-semibold mb-0">Surface Color (Cards/Modals)</label>
                                <small class="text-muted d-block mb-2">Background used for cards, panels, and modal surfaces sitting on the page background.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="surfaceColor" @bind="colorSettings.SurfaceColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="surfaceColorHex">Hex</label>
                                        <input id="surfaceColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.SurfaceColor" placeholder="#ffffff" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="background:@colorSettings.SurfaceColor; border:1px solid @colorSettings.BorderColor; color:@colorSettings.TextColor;">
                                    Card/surface preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="surfaceAltColor" class="form-label fw-semibold mb-0">Surface Alt (Secondary surfaces)</label>
                                <small class="text-muted d-block mb-2">Alternate surface used for secondary sections (ex: table headers, light buttons, footers in some layouts).</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="surfaceAltColor" @bind="colorSettings.SurfaceAltColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="surfaceAltColorHex">Hex</label>
                                        <input id="surfaceAltColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.SurfaceAltColor" placeholder="#f8f9fa" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="background:@colorSettings.SurfaceAltColor; border:1px solid @colorSettings.BorderColor; color:@colorSettings.TextColor;">
                                    Alt surface preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="inputBgColor" class="form-label fw-semibold mb-0">Input Background</label>
                                <small class="text-muted d-block mb-2">Background for form inputs and text fields.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="inputBgColor" @bind="colorSettings.InputBgColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="inputBgColorHex">Hex</label>
                                        <input id="inputBgColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.InputBgColor" placeholder="#ffffff" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <input class="form-control form-control-sm" style="background:@colorSettings.InputBgColor; border-color:@colorSettings.BorderColor; color:@colorSettings.TextColor;" placeholder="Input preview" />
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="borderColor" class="form-label fw-semibold mb-0">Border Color</label>
                                <small class="text-muted d-block mb-2">Used for outlines on cards, inputs, and separators.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="borderColor" @bind="colorSettings.BorderColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="borderColorHex">Hex</label>
                                        <input id="borderColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.BorderColor" placeholder="#dee2e6" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="border:2px solid @colorSettings.BorderColor; background:@colorSettings.SurfaceColor; color:@colorSettings.TextColor;">
                                    Border preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="headerFooterTextColor" class="form-label fw-semibold mb-0">Header/Footer Text Color</label>
                                <small class="text-muted d-block mb-2">Text color used on top of header/footer backgrounds.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="headerFooterTextColor" @bind="colorSettings.HeaderFooterTextColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="headerFooterTextColorHex">Hex</label>
                                        <input id="headerFooterTextColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.HeaderFooterTextColor" placeholder="#ffffff" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded px-2 py-1" style="background:@colorSettings.HeaderFooterBgColor; color:@colorSettings.HeaderFooterTextColor; font-weight:600;">
                                    Header/Footer text preview
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <h6 class="mb-3">Dark Mode Palette</h6>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="border rounded p-3 mb-3">
                                <label for="darkPrimaryColor" class="form-label fw-semibold mb-0">Links/Highlights (also Hero badge)</label>
                                <small class="text-muted d-block mb-2">Used for link color, accents, and the hero badge color.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkPrimaryColor" @bind="colorSettings.DarkPrimaryColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkPrimaryColorHex">Hex</label>
                                        <input id="darkPrimaryColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkPrimaryColor" placeholder="#569cd6" />
                                    </div>
                                </div>
                                <div class="mt-2 d-flex flex-wrap align-items-center gap-2">
                                    <a href="javascript:void(0)" style="color:@colorSettings.DarkPrimaryColor; text-decoration:underline;">Link preview</a>
                                    <span class="rounded-pill px-2 py-1" style="background:@colorSettings.DarkPrimaryColor; color:#fff; font-weight:600;">Hero badge</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkHeaderFooterBgColor" class="form-label fw-semibold mb-0">Header/Footer Background</label>
                                <small class="text-muted d-block mb-2">Used for the navbar and footer background color.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkHeaderFooterBgColor" @bind="colorSettings.DarkHeaderFooterBgColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkHeaderFooterBgColorHex">Hex</label>
                                        <input id="darkHeaderFooterBgColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkHeaderFooterBgColor" placeholder="#2d2d30" />
                                    </div>
                                </div>
                                <div class="mt-2 d-flex flex-wrap align-items-center gap-2">
                                    <span class="rounded px-2 py-1" style="background:@colorSettings.DarkHeaderFooterBgColor; color:@colorSettings.DarkHeaderFooterTextColor; font-weight:600;">Header/Footer</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkSecondaryColor" class="form-label fw-semibold mb-0">Secondary Color</label>
                                <small class="text-muted d-block mb-2">Used for secondary accents and UI emphasis.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkSecondaryColor" @bind="colorSettings.DarkSecondaryColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkSecondaryColorHex">Hex</label>
                                        <input id="darkSecondaryColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkSecondaryColor" placeholder="#4f8cc4" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="rounded-pill px-2 py-1" style="background:@colorSettings.DarkSecondaryColor; color:#fff; font-weight:600;">Secondary</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkAccentColor" class="form-label fw-semibold mb-0">Accent Color</label>
                                <small class="text-muted d-block mb-2">Used for smaller accents, callouts, and decorative highlights.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkAccentColor" @bind="colorSettings.DarkAccentColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkAccentColorHex">Hex</label>
                                        <input id="darkAccentColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkAccentColor" placeholder="#9cdcfe" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="rounded-pill px-2 py-1" style="background:@colorSettings.DarkAccentColor; color:#fff; font-weight:600;">Accent</span>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkTextColor" class="form-label fw-semibold mb-0">Text Color</label>
                                <small class="text-muted d-block mb-2">Default text color used across most pages and cards.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkTextColor" @bind="colorSettings.DarkTextColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkTextColorHex">Hex</label>
                                        <input id="darkTextColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkTextColor" placeholder="#d4d4d4" />
                                    </div>
                                </div>
                                <div class="mt-2 small" style="color:@colorSettings.DarkTextColor;">
                                    Sample text preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkBgColor" class="form-label fw-semibold mb-0">Background Color</label>
                                <small class="text-muted d-block mb-2">Main page background behind everything.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkBgColor" @bind="colorSettings.DarkBgColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkBgColorHex">Hex</label>
                                        <input id="darkBgColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkBgColor" placeholder="#1e1e1e" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="background:@colorSettings.DarkBgColor; border:1px solid @colorSettings.DarkBorderColor; color:@colorSettings.DarkTextColor;">
                                    Page background preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkButtonColor" class="form-label fw-semibold mb-0">Button Color</label>
                                <small class="text-muted d-block mb-2">Primary button background color.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkButtonColor" @bind="colorSettings.DarkButtonColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkButtonColorHex">Hex</label>
                                        <input id="darkButtonColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkButtonColor" placeholder="#569cd6" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <button type="button" class="btn btn-sm" style="background:@colorSettings.DarkButtonColor; border-color:@colorSettings.DarkButtonColor; color:#fff; font-weight:600;">Button</button>
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkSurfaceColor" class="form-label fw-semibold mb-0">Surface Color (Cards/Modals)</label>
                                <small class="text-muted d-block mb-2">Background used for cards, panels, and modal surfaces sitting on the page background.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkSurfaceColor" @bind="colorSettings.DarkSurfaceColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkSurfaceColorHex">Hex</label>
                                        <input id="darkSurfaceColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkSurfaceColor" placeholder="#252526" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="background:@colorSettings.DarkSurfaceColor; border:1px solid @colorSettings.DarkBorderColor; color:@colorSettings.DarkTextColor;">
                                    Card/surface preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkSurfaceAltColor" class="form-label fw-semibold mb-0">Surface Alt (Secondary surfaces)</label>
                                <small class="text-muted d-block mb-2">Alternate surface used for secondary sections (ex: table headers, light buttons, footers in some layouts).</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkSurfaceAltColor" @bind="colorSettings.DarkSurfaceAltColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkSurfaceAltColorHex">Hex</label>
                                        <input id="darkSurfaceAltColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkSurfaceAltColor" placeholder="#2d2d30" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="background:@colorSettings.DarkSurfaceAltColor; border:1px solid @colorSettings.DarkBorderColor; color:@colorSettings.DarkTextColor;">
                                    Alt surface preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkInputBgColor" class="form-label fw-semibold mb-0">Input Background</label>
                                <small class="text-muted d-block mb-2">Background for form inputs and text fields.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkInputBgColor" @bind="colorSettings.DarkInputBgColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkInputBgColorHex">Hex</label>
                                        <input id="darkInputBgColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkInputBgColor" placeholder="#3c3c3c" />
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <input class="form-control form-control-sm" style="background:@colorSettings.DarkInputBgColor; border-color:@colorSettings.DarkBorderColor; color:@colorSettings.DarkTextColor;" placeholder="Input preview" />
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkBorderColor" class="form-label fw-semibold mb-0">Border Color</label>
                                <small class="text-muted d-block mb-2">Used for outlines on cards, inputs, and separators.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkBorderColor" @bind="colorSettings.DarkBorderColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkBorderColorHex">Hex</label>
                                        <input id="darkBorderColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkBorderColor" placeholder="#3e3e42" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded p-2" style="border:2px solid @colorSettings.DarkBorderColor; background:@colorSettings.DarkSurfaceColor; color:@colorSettings.DarkTextColor;">
                                    Border preview
                                </div>
                            </div>

                            <div class="border rounded p-3 mb-3">
                                <label for="darkHeaderFooterTextColor" class="form-label fw-semibold mb-0">Header/Footer Text Color</label>
                                <small class="text-muted d-block mb-2">Text color used on top of header/footer backgrounds.</small>
                                <div class="row g-2 align-items-end">
                                    <div class="col-6 col-md-4">
                                        <input type="color" class="color-input" id="darkHeaderFooterTextColor" @bind="colorSettings.DarkHeaderFooterTextColor" />
                                    </div>
                                    <div class="col-6 col-md-8">
                                        <label class="form-label small text-muted mb-1" for="darkHeaderFooterTextColorHex">Hex</label>
                                        <input id="darkHeaderFooterTextColorHex" type="text" class="form-control form-control-sm" @bind="colorSettings.DarkHeaderFooterTextColor" placeholder="#ffffff" />
                                    </div>
                                </div>
                                <div class="mt-2 rounded px-2 py-1" style="background:@colorSettings.DarkHeaderFooterBgColor; color:@colorSettings.DarkHeaderFooterTextColor; font-weight:600;">
                                    Header/Footer text preview
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="fas fa-save me-2"></i>Save Colors
                    </button>
                    <button type="button" class="btn btn-secondary" @onclick="ResetColors">
                        <i class="fas fa-undo me-2"></i>Reset to Defaults
                    </button>
                </div>

                @if (!string.IsNullOrEmpty(colorMessage))
                {
                    <div class="alert alert-success mt-3" role="alert">
                        @colorMessage
                    </div>
                }
            </form>

            <div class="preview-section mt-5">
                <h6 class="mb-3"><i class="fas fa-eye me-2"></i>Live Preview</h6>
                
                <p class="mb-2"><small class="text-muted">Your site will update with these colors immediately:</small></p>

                <div class="theme-preview" style="@GetPreviewCssVars()">
                    <div class="min-vh-100 d-flex flex-column">
                        <header class="navbar navbar-expand-lg navbar-dark w-100" style="background-color: var(--header-footer-bg-color); padding: 0.5rem 1rem;">
                            <a class="navbar-brand flex-shrink-0" href="javascript:void(0)">NE Plumbing Inc.</a>

                            <div class="d-flex navbar-nav-center ms-3">
                                <a class="nav-link text-white me-3" href="javascript:void(0)">
                                    <span class="oi oi-home" aria-hidden="true"></span> Home
                                </a>
                                <a class="nav-link text-white me-3" href="javascript:void(0)">
                                    <span class="oi oi-plus" aria-hidden="true"></span> Services
                                </a>
                            </div>

                            <div class="d-flex navbar-controls ms-auto">
                                <button class="dark-mode-toggle" type="button" onclick="window.ToggleDarkMode && window.ToggleDarkMode()" title="Toggle dark mode">
                                    <i class="fas fa-moon dark-mode-icon-moon" aria-hidden="true"></i>
                                    <i class="fas fa-sun dark-mode-icon-sun" aria-hidden="true"></i>
                                </button>

                                <div class="d-flex align-items-center gap-2">
                                    <a class="nav-link text-white" href="javascript:void(0)">
                                        <span class="oi oi-account-logout" aria-hidden="true"></span> Admin dashboard
                                    </a>
                                    <a class="nav-link text-white" href="javascript:void(0)">
                                        <span class="oi oi-account-logout" aria-hidden="true"></span> Logout
                                    </a>
                                </div>
                            </div>
                        </header>

                        <main class="container my-4 flex-grow-1">
                            <div class="card">
                                <div class="card-body">
                                    <strong>Headline</strong>
                                    <span class="preview-badge">Hero Badge</span>
                                    <p class="mt-2 mb-2">
                                        Preview text and a <a class="preview-link" href="javascript:void(0)">link</a>.
                                    </p>
                                    <div class="d-flex flex-wrap gap-2">
                                        <button type="button" class="btn btn-primary btn-sm">Primary</button>
                                        <button type="button" class="btn btn-outline-primary btn-sm">Outline</button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm">Secondary</button>
                                    </div>
                                </div>
                            </div>

                            <div class="card mt-3">
                                <div class="card-body">
                                    <label class="form-label">Sample input</label>
                                    <input class="form-control" placeholder="Type here..." />
                                </div>
                            </div>
                        </main>

                        <footer class="text-white py-4 mt-auto" style="background-color: var(--header-footer-bg-color);">
                            <div class="container">
                                <div class="row text-center text-md-start">
                                    <div class="col-md-4 mb-3">
                                        <h5>About Us</h5>
                                        <p class="mb-0">NE Plumbing Inc. brings 20+ years of experience in residential, commercial, and luxury plumbing. We’re proud to serve all of Utah with expert service and professionalism.</p>
                                    </div>

                                    @if (careersSettings?.IsHiringEnabled ?? true)
                                    {
                                        <div class="col-md-4 mb-3">
                                            <h5>Now Hiring</h5>
                                            <p class="mb-1">We're looking for skilled plumbers to join our team!</p>
                                            <a href="javascript:void(0)" class="btn btn-outline-light btn-sm">Apply Now</a>
                                        </div>
                                    }

                                    <div class="col-md-4 mb-3">
                                        <h5>Connect With Us</h5>

                                        <p class="mb-1">
                                            <a href="javascript:void(0)" class="text-white text-decoration-none">
                                                <i class="fab fa-instagram fa-lg me-2"></i>Instagram
                                            </a>
                                        </p>

                                        <p class="mb-1">
                                            <a href="javascript:void(0)" class="text-white text-decoration-none">
                                                <i class="fas fa-phone fa-sm me-2"></i>(801) 641-3246
                                            </a>
                                        </p>

                                        <p class="mb-0">
                                            <a href="javascript:void(0)" class="text-white text-decoration-none">
                                                <i class="fas fa-envelope fa-sm me-2"></i>neplumbinginc@gmail.com
                                            </a>
                                        </p>

                                        <p class="mt-3">
                                            <a href="javascript:void(0)" class="btn btn-outline-light btn-sm">Contact Us</a>
                                        </p>
                                    </div>
                                </div>

                                <hr class="border-secondary" />

                                <div class="text-center small">
                                    &copy; @(DateTime.Now.Year) NE Plumbing Inc. All rights reserved.
                                </div>
                            </div>
                        </footer>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="card shadow-sm">
        <div class="card-body">
            <p class="text-muted">Loading color settings...</p>
        </div>
    </div>
}

@code {
    private ColorSettings? colorSettings;
    private CareersPageSettings? careersSettings;
    private string fontMessage = "";
    private string colorMessage = "";
    private CancellationTokenSource? clearMessageCts;
    private string activePalette = "light";

    private bool showFontMenu;

    private bool? isFontLoaded;

    private string selectedPresetId = "default";

    private static readonly string[] AvailableFonts =
    [
        "Inter",
        "Manrope",
        "Nunito Sans",
        "Plus Jakarta Sans",
        "Poppins",
        "Montserrat",
        "Merriweather",
        "Roboto Slab",
        "Raleway",
        "DM Sans",
        "Rubik",
        "Work Sans",
        "Figtree",
        "Oswald",
        "Quicksand",
        "Space Grotesk",
        "Playfair Display",
        "Lora",
        "Spectral",
        "Crimson Text",
        "Source Serif 4",
        "Alegreya",
        "Cinzel",
        "Cormorant Garamond",
        "Libre Baskerville",
        "IM Fell English",
        "Special Elite",
        "Comfortaa",
        "Fredoka",
        "Patrick Hand",
        "Amatic SC",
        "Pacifico",
        "Source Sans 3",
        "IBM Plex Sans",
        "Archivo",
        "Sora",
        "Barlow",
        "Mulish",
        "Bebas Neue",
        "Alfa Slab One",
        "Black Ops One",
        "Vollkorn SC",
        "Kalam",
        "Caveat",
        "Handlee",
        "Shadows Into Light",
    ];

    private void ToggleFontMenu() => showFontMenu = !showFontMenu;

    private async Task SelectFontAsync(string font)
    {
        if (colorSettings is null)
        {
            return;
        }

        colorSettings.FontFamily = font;
        showFontMenu = false;

        await OnFontChangedAsync();
    }

    private string GetFontOptionStyle(string? fontFamily)
    {
        var cssValue = GetFontCssValue(fontFamily);
        return $"font-family: {cssValue}, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;";
    }

    private void SetLightPalette() => activePalette = "light";
    private void SetDarkPalette() => activePalette = "dark";

    private sealed record ThemePreset(
        string Id,
        string Name,
        string Primary,
        string Secondary,
        string Accent,
        string Text,
        string Background,
        string HeroBadge,
        string Button,
        string Surface,
        string SurfaceAlt,
        string InputBg,
        string Border,
        string HeaderFooterText,
        string FontFamily);

    private IReadOnlyList<ThemePreset> GetPresetsForActivePalette()
    {
        if (activePalette == "light")
        {
            return new List<ThemePreset>
            {
                new(
                    "default",
                    "Default (NE Plumbing)",
                    "#0066CC",
                    "#005299",
                    "#003d7a",
                    "#212529",
                    "#f8f9fa",
                    "#0056b3",
                    "#0066CC",
                    "#ffffff",
                    "#f8f9fa",
                    "#ffffff",
                    "#dee2e6",
                    "#ffffff",
                    "Inter"),
                new(
                    "neutral",
                    "Neutral (clean + minimal)",
                    "#0d6efd",
                    "#6c757d",
                    "#0d6efd",
                    "#212529",
                    "#f8f9fa",
                    "#0d6efd",
                    "#0d6efd",
                    "#ffffff",
                    "#f8f9fa",
                    "#ffffff",
                    "#dee2e6",
                    "#ffffff",
                    "Manrope"),
            };
        }

        return new List<ThemePreset>
        {
            new(
                "default",
                "Default Dark (VS-style)",
                "#569cd6",
                "#4f8cc4",
                "#9cdcfe",
                "#d4d4d4",
                "#1e1e1e",
                "#2d2d30",
                "#569cd6",
                "#252526",
                "#2d2d30",
                "#3c3c3c",
                "#3e3e42",
                "#ffffff",
                "Inter"),
            new(
                "oled",
                "OLED Dark (deeper blacks)",
                "#6cb6ff",
                "#8b949e",
                "#6cb6ff",
                "#e6edf3",
                "#0d1117",
                "#161b22",
                "#6cb6ff",
                "#161b22",
                "#0d1117",
                "#0d1117",
                "#30363d",
                "#ffffff",
                "Plus Jakarta Sans"),
        };
    }

    private void ApplySelectedPreset()
    {
        if (colorSettings is null)
        {
            return;
        }

        var preset = GetPresetsForActivePalette().FirstOrDefault(p => p.Id == selectedPresetId)
            ?? GetPresetsForActivePalette().First();

        colorSettings.FontFamily = preset.FontFamily;

        if (activePalette == "light")
        {
            colorSettings.PrimaryColor = preset.Primary;
            colorSettings.HeaderFooterBgColor = preset.Primary;
            colorSettings.SecondaryColor = preset.Secondary;
            colorSettings.AccentColor = preset.Accent;
            colorSettings.TextColor = preset.Text;
            colorSettings.LightBgColor = preset.Background;
            // Hero badge always follows links/highlights
            colorSettings.HeroBadgeColor = colorSettings.PrimaryColor;
            colorSettings.ButtonColor = preset.Button;
            colorSettings.SurfaceColor = preset.Surface;
            colorSettings.SurfaceAltColor = preset.SurfaceAlt;
            colorSettings.InputBgColor = preset.InputBg;
            colorSettings.BorderColor = preset.Border;
            colorSettings.HeaderFooterTextColor = preset.HeaderFooterText;
        }
        else
        {
            colorSettings.DarkPrimaryColor = preset.Primary;
            colorSettings.DarkHeaderFooterBgColor = preset.SurfaceAlt;
            colorSettings.DarkSecondaryColor = preset.Secondary;
            colorSettings.DarkAccentColor = preset.Accent;
            colorSettings.DarkTextColor = preset.Text;
            colorSettings.DarkBgColor = preset.Background;
            // Hero badge always follows links/highlights
            colorSettings.DarkHeroBadgeColor = colorSettings.DarkPrimaryColor;
            colorSettings.DarkButtonColor = preset.Button;
            colorSettings.DarkSurfaceColor = preset.Surface;
            colorSettings.DarkSurfaceAltColor = preset.SurfaceAlt;
            colorSettings.DarkInputBgColor = preset.InputBg;
            colorSettings.DarkBorderColor = preset.Border;
            colorSettings.DarkHeaderFooterTextColor = preset.HeaderFooterText;
        }
    }

    private string GetPreviewCssVars()
    {
        if (colorSettings is null)
        {
            return string.Empty;
        }

        var fontCssValue = GetFontCssValue(colorSettings.FontFamily);

        if (activePalette == "light")
        {
             return $"--primary-color:{colorSettings.PrimaryColor};" +
                   $"--secondary-color:{colorSettings.SecondaryColor};" +
                   $"--accent-color:{colorSettings.AccentColor};" +
                   $"--text-color:{colorSettings.TextColor};" +
                   $"--page-bg-color:{colorSettings.LightBgColor};" +
                 $"--hero-badge-color:{colorSettings.PrimaryColor};" +
                 $"--header-footer-bg-color:{colorSettings.HeaderFooterBgColor};" +
                   $"--button-color:{colorSettings.ButtonColor};" +
                   $"--surface-color:{colorSettings.SurfaceColor};" +
                   $"--surface-alt-color:{colorSettings.SurfaceAltColor};" +
                   $"--input-bg-color:{colorSettings.InputBgColor};" +
                   $"--bs-border-color:{colorSettings.BorderColor};" +
                                        $"--header-footer-text-color:{colorSettings.HeaderFooterTextColor};" +
                                        $"--site-font-family:{fontCssValue};" +
                   $"--bs-link-color:{colorSettings.PrimaryColor};" +
                   $"--bs-link-hover-color:{colorSettings.AccentColor};";
        }

        return $"--primary-color:{colorSettings.DarkPrimaryColor};" +
               $"--secondary-color:{colorSettings.DarkSecondaryColor};" +
               $"--accent-color:{colorSettings.DarkAccentColor};" +
               $"--text-color:{colorSettings.DarkTextColor};" +
               $"--page-bg-color:{colorSettings.DarkBgColor};" +
             $"--hero-badge-color:{colorSettings.DarkPrimaryColor};" +
             $"--header-footer-bg-color:{colorSettings.DarkHeaderFooterBgColor};" +
               $"--button-color:{colorSettings.DarkButtonColor};" +
               $"--surface-color:{colorSettings.DarkSurfaceColor};" +
               $"--surface-alt-color:{colorSettings.DarkSurfaceAltColor};" +
               $"--input-bg-color:{colorSettings.DarkInputBgColor};" +
               $"--bs-border-color:{colorSettings.DarkBorderColor};" +
               $"--header-footer-text-color:{colorSettings.DarkHeaderFooterTextColor};" +
               $"--site-font-family:{fontCssValue};" +
               $"--bs-link-color:{colorSettings.DarkPrimaryColor};" +
               $"--bs-link-hover-color:{colorSettings.DarkAccentColor};";
    }

    private static string GetFontCssValue(string? fontFamily)
    {
        return (fontFamily ?? "Inter") switch
        {
            "Inter" => "'Inter'",
            "Manrope" => "'Manrope'",
            "Nunito Sans" => "'Nunito Sans'",
            "Plus Jakarta Sans" => "'Plus Jakarta Sans'",
            "Poppins" => "'Poppins'",
            "Montserrat" => "'Montserrat'",
            "Merriweather" => "'Merriweather'",
            "Roboto Slab" => "'Roboto Slab'",
            "Raleway" => "'Raleway'",
            "DM Sans" => "'DM Sans'",
            "Rubik" => "'Rubik'",
            "Work Sans" => "'Work Sans'",
            "Figtree" => "'Figtree'",
            "Oswald" => "'Oswald'",
            "Quicksand" => "'Quicksand'",
            "Space Grotesk" => "'Space Grotesk'",
            "Playfair Display" => "'Playfair Display'",
            "Lora" => "'Lora'",
            "Spectral" => "'Spectral'",
            "Crimson Text" => "'Crimson Text'",
            "Source Serif 4" => "'Source Serif 4'",
            "Alegreya" => "'Alegreya'",
            "Cinzel" => "'Cinzel'",
            "Cormorant Garamond" => "'Cormorant Garamond'",
            "Libre Baskerville" => "'Libre Baskerville'",
            "IM Fell English" => "'IM Fell English'",
            "Special Elite" => "'Special Elite'",
            "Comfortaa" => "'Comfortaa'",
            "Fredoka" => "'Fredoka'",
            "Patrick Hand" => "'Patrick Hand'",
            "Amatic SC" => "'Amatic SC'",
            "Pacifico" => "'Pacifico'",
            "Source Sans 3" => "'Source Sans 3'",
            "IBM Plex Sans" => "'IBM Plex Sans'",
            "Archivo" => "'Archivo'",
            "Sora" => "'Sora'",
            "Barlow" => "'Barlow'",
            "Mulish" => "'Mulish'",
            "Bebas Neue" => "'Bebas Neue'",
            "Alfa Slab One" => "'Alfa Slab One'",
            "Black Ops One" => "'Black Ops One'",
            "Vollkorn SC" => "'Vollkorn SC'",
            "Kalam" => "'Kalam'",
            "Caveat" => "'Caveat'",
            "Handlee" => "'Handlee'",
            "Shadows Into Light" => "'Shadows Into Light'",
            _ => "'Inter'",
        };
    }

    private string GetAdminFontStyle()
    {
        var fontCssValue = GetFontCssValue(colorSettings?.FontFamily);
        return $"font-family: {fontCssValue}, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;";
    }

    protected override async Task OnInitializedAsync()
    {
        colorSettings = await ColorSettingsService.GetColorSettingsAsync();
        careersSettings = await CareersPageSettingsService.GetSettingsAsync();

        await ApplyFontToPageAsync();
        await UpdateFontLoadedStatusAsync();
    }

    private async Task OnFontChangedAsync()
    {
        await ApplyFontToPageAsync();
        await UpdateFontLoadedStatusAsync();
    }

    private async Task ApplyFontToPageAsync()
    {
        if (colorSettings is null)
        {
            return;
        }

        var cssValue = GetFontCssValue(colorSettings.FontFamily);
        await JS.InvokeVoidAsync("nepFonts.setActiveFont", cssValue);
    }

    private async Task UpdateFontLoadedStatusAsync()
    {
        if (colorSettings is null)
        {
            isFontLoaded = null;
            return;
        }

        var cssValue = GetFontCssValue(colorSettings.FontFamily);

        // JS expects a CSS font-family token like: 'Inter'
        isFontLoaded = await JS.InvokeAsync<bool?>("nepFonts.isLoaded", cssValue);
    }

    private async Task SaveColors()
    {
        if (colorSettings != null)
        {
            try
            {
                await ColorSettingsService.UpdateColorSettingsAsync(colorSettings);
                colorMessage = "Colors updated successfully! Refresh the page to see the changes everywhere.";
                ScheduleClearMessage(TimeSpan.FromSeconds(5));
            }
            catch (Exception ex)
            {
                colorMessage = $"Error saving colors: {ex.Message}";
            }
        }
    }

    private async Task SaveFont()
    {
        if (colorSettings is null)
        {
            return;
        }

        try
        {
            await ColorSettingsService.UpdateFontFamilyAsync(colorSettings.FontFamily);

            // Persist the selected font in the browser too (helps enhanced navigation keep it applied).
            var cssValue = GetFontCssValue(colorSettings.FontFamily);
            await JS.InvokeVoidAsync("nepFonts.savePreference", cssValue);

            fontMessage = "Font updated successfully! Refresh the page to see the changes everywhere.";
            ScheduleClearMessage(TimeSpan.FromSeconds(5));
        }
        catch (Exception ex)
        {
            fontMessage = $"Error saving font: {ex.Message}";
        }
    }

    private async Task ResetColors()
    {
        try
        {
            await ColorSettingsService.ResetToDefaultAsync();
            colorSettings = await ColorSettingsService.GetColorSettingsAsync();
            colorMessage = "Colors reset to defaults! Refresh the page to see the changes.";
            ScheduleClearMessage(TimeSpan.FromSeconds(5));
        }
        catch (Exception ex)
        {
            colorMessage = $"Error resetting colors: {ex.Message}";
        }
    }

    private void ScheduleClearMessage(TimeSpan delay)
    {
        clearMessageCts?.Cancel();
        clearMessageCts?.Dispose();
        clearMessageCts = new CancellationTokenSource();

        var token = clearMessageCts.Token;
        _ = ClearMessageAfterDelayAsync(delay, token);
    }

    private async Task ClearMessageAfterDelayAsync(TimeSpan delay, CancellationToken cancellationToken)
    {
        try
        {
            await Task.Delay(delay, cancellationToken);
        }
        catch (TaskCanceledException)
        {
            return;
        }

        fontMessage = "";
        colorMessage = "";
        await InvokeAsync(StateHasChanged);
    }
}
