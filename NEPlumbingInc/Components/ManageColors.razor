@inject IColorSettingsService ColorSettingsService
@inject ICareersPageSettingsService CareersPageSettingsService
@inject IJSRuntime JS
@rendermode InteractiveServer

<style>
    .color-picker-group {
        display: flex;
        align-items: flex-end;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .color-input-wrapper {
        flex: 1;
    }

    .color-input-wrapper label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .color-input {
        width: 100%;
        height: 50px;
        border: 2px solid #dee2e6;
        border-radius: 0.375rem;
        cursor: pointer;
    }

    .color-input:hover {
        border-color: #0066CC;
    }

    .color-preview {
        display: inline-block;
        width: 40px;
        height: 40px;
        border-radius: 0.375rem;
        border: 2px solid #dee2e6;
        margin-left: 0.5rem;
    }

    .preview-section {
        margin-top: 2rem;
        padding: 2rem;
        border-radius: 0.5rem;
        background-color: #f8f9fa;
    }

    .preview-section[data-dark-mode="true"] {
        background-color: #2a2a2a;
    }

    .preview-btn {
        padding: 0.5rem 1rem;
        margin: 0.5rem;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        font-weight: 500;
    }

    .preview-card {
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 0.375rem;
        border: 1px solid #dee2e6;
        background-color: white;
    }

    .preview-card[data-dark-mode="true"] {
        background-color: #3a3a3a;
        border-color: #555;
    }

    .theme-preview {
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        overflow: hidden;
        background: var(--page-bg-color);
        color: var(--text-color);
        font-family: var(--site-font-family), system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    .theme-preview .min-vh-100 {
        min-height: 0 !important;
    }

    .theme-preview .preview-navbar .brand {
        font-weight: 700;
    }

    .theme-preview .preview-navbar .nav-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .theme-preview .preview-content {
        padding: 1rem;
    }

    .theme-preview .preview-surface {
        background: var(--surface-color);
        border: 1px solid var(--bs-border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .theme-preview .preview-badge {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        background: var(--hero-badge-color);
        color: #fff;
        font-weight: 600;
        margin-left: 0.5rem;
    }

    .theme-preview .preview-link {
        color: var(--bs-link-color);
        text-decoration: underline;
    }

    .theme-preview .preview-link:hover {
        color: var(--bs-link-hover-color);
    }

    .theme-preview .preview-btn-primary {
        background: var(--button-color);
        border: 1px solid var(--button-color);
        color: #fff;
        border-radius: 0.375rem;
        padding: 0.4rem 0.75rem;
        font-weight: 600;
    }

    .theme-preview .preview-btn-outline {
        background: transparent;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
        border-radius: 0.375rem;
        padding: 0.4rem 0.75rem;
        font-weight: 600;
    }

    .theme-preview .preview-input {
        width: 100%;
        background: var(--input-bg-color);
        border: 1px solid var(--bs-border-color);
        color: var(--text-color);
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
    }
</style>

@if (colorSettings != null)
{
    <div class="card shadow-sm mb-3" style="@GetAdminFontStyle()">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-font me-2"></i>Typography</h5>
        </div>
        <div class="card-body">
            <div class="mb-2">
                <label for="fontFamily" class="form-label">Site Font</label>
                <select id="fontFamily" class="form-select" @bind="colorSettings.FontFamily" @bind:after="OnFontChangedAsync">
                    <option value="Inter">Inter</option>
                    <option value="Manrope">Manrope</option>
                    <option value="Nunito Sans">Nunito Sans</option>
                    <option value="Plus Jakarta Sans">Plus Jakarta Sans</option>
                    <option value="Poppins">Poppins</option>
                    <option value="Montserrat">Montserrat</option>
                    <option value="Merriweather">Merriweather</option>
                    <option value="Roboto Slab">Roboto Slab</option>
                    <option value="Raleway">Raleway</option>
                    <option value="DM Sans">DM Sans</option>
                    <option value="Rubik">Rubik</option>
                    <option value="Work Sans">Work Sans</option>
                    <option value="Figtree">Figtree</option>
                    <option value="Oswald">Oswald</option>
                    <option value="Quicksand">Quicksand</option>
                    <option value="Space Grotesk">Space Grotesk</option>
                    <option value="Playfair Display">Playfair Display</option>
                    <option value="Lora">Lora</option>
                </select>
                <small class="text-muted">Updates this page immediately (including header/footer) so you can preview. Use <strong>Save Font</strong> to apply site-wide.</small>

                <div class="mt-1 small text-muted">
                    <div>Selected: <strong>@(colorSettings.FontFamily)</strong></div>
                    @if (isFontLoaded is true)
                    {
                        <div>Font file loaded: <strong>Yes</strong></div>
                    }
                    else if (isFontLoaded is false)
                    {
                        <div>Font file loaded: <strong>No</strong> (likely blocked; check network/adblock/CSP for fonts.googleapis.com + fonts.gstatic.com)</div>
                    }
                    else
                    {
                        <div>Font file loaded: <strong>Unknown</strong> (browser doesn’t support detection)</div>
                    }
                </div>
            </div>

            <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-primary" @onclick="SaveFont">
                    <i class="fas fa-save me-2"></i>Save Font
                </button>
            </div>

            <div class="mt-3 p-3 rounded" style="background: var(--surface-color); border: 1px solid var(--bs-border-color); color: var(--text-color);">
                <div class="d-flex flex-wrap align-items-end gap-3">
                    <div style="font-size: 3rem; line-height: 1; font-weight: 700;">Aa</div>
                    <div>
                        <div class="fw-semibold" style="font-size: 1.25rem;">NE Plumbing Inc. — Typography Preview</div>
                        <div class="text-muted">The quick brown fox jumps over the lazy dog. 0123456789</div>
                    </div>
                </div>

                <hr style="border-color: var(--bs-border-color);" />

                <p class="mb-2">
                    This is sample body text to help you compare readability and personality.
                    Here’s a <a href="javascript:void(0)" style="color: var(--bs-link-color);">link</a> and a few UI elements:
                </p>

                <div class="d-flex flex-wrap gap-2">
                    <button type="button" class="btn btn-primary btn-sm">Primary</button>
                    <button type="button" class="btn btn-outline-primary btn-sm">Outline</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm">Secondary</button>
                </div>
            </div>

            @if (!string.IsNullOrEmpty(fontMessage))
            {
                <div class="alert alert-success mt-3" role="alert">
                    @fontMessage
                </div>
            }
        </div>
    </div>

    <div class="card shadow-sm" style="@GetAdminFontStyle()">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-palette me-2"></i>Manage Site Colors</h5>
        </div>
        <div class="card-body">
            <form @onsubmit="SaveColors" @onsubmit:preventDefault="true">

                <ul class="nav nav-tabs mb-3">
                    <li class="nav-item">
                        <button type="button"
                                class="nav-link @(activePalette == "light" ? "active" : "")"
                                @onclick="SetLightPalette">
                            Light
                        </button>
                    </li>
                    <li class="nav-item">
                        <button type="button"
                                class="nav-link @(activePalette == "dark" ? "active" : "")"
                                @onclick="SetDarkPalette">
                            Dark
                        </button>
                    </li>
                </ul>

                <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
                    <div>
                        <small class="text-muted d-block">@(activePalette == "light" ? "Light" : "Dark") preset</small>
                        <select class="form-select form-select-sm" style="min-width: 220px" @bind="selectedPresetId">
                            @foreach (var preset in GetPresetsForActivePalette())
                            {
                                <option value="@preset.Id">@preset.Name</option>
                            }
                        </select>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary" @onclick="ApplySelectedPreset">
                        Apply preset
                    </button>
                    <div class="form-check ms-auto">
                        <input class="form-check-input" type="checkbox" id="showAdvanced" @bind="showAdvanced" />
                        <label class="form-check-label" for="showAdvanced">Show advanced (hex)</label>
                    </div>
                </div>

                @if (activePalette == "light")
                {
                    <h6 class="mb-3">Light Mode Palette</h6>

                <div class="row">
                    <div class="col-md-6">
                        <div class="color-input-wrapper">
                            <label for="primaryColor">Primary Color (Navbar/Footer)</label>
                            <input type="color" class="color-input" id="primaryColor"
                                   @bind="colorSettings.PrimaryColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="secondaryColor">Secondary Color</label>
                            <input type="color" class="color-input" id="secondaryColor"
                                   @bind="colorSettings.SecondaryColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="accentColor">Accent Color</label>
                            <input type="color" class="color-input" id="accentColor"
                                   @bind="colorSettings.AccentColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="textColor">Text Color</label>
                            <input type="color" class="color-input" id="textColor"
                                   @bind="colorSettings.TextColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="bgColor">Background Color</label>
                            <input type="color" class="color-input" id="bgColor"
                                   @bind="colorSettings.LightBgColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="heroBadgeColor">Hero Badge Background</label>
                            <input type="color" class="color-input" id="heroBadgeColor"
                                   @bind="colorSettings.HeroBadgeColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="buttonColor">Button Color</label>
                            <input type="color" class="color-input" id="buttonColor"
                                   @bind="colorSettings.ButtonColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="surfaceColor">Surface Color (Cards/Modals)</label>
                            <input type="color" class="color-input" id="surfaceColor"
                                   @bind="colorSettings.SurfaceColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="surfaceAltColor">Surface Alt (Headers/Footers)</label>
                            <input type="color" class="color-input" id="surfaceAltColor"
                                   @bind="colorSettings.SurfaceAltColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="inputBgColor">Input Background</label>
                            <input type="color" class="color-input" id="inputBgColor"
                                   @bind="colorSettings.InputBgColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="borderColor">Border Color</label>
                            <input type="color" class="color-input" id="borderColor"
                                   @bind="colorSettings.BorderColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="headerFooterTextColor">Header/Footer Text Color</label>
                            <input type="color" class="color-input" id="headerFooterTextColor"
                                   @bind="colorSettings.HeaderFooterTextColor" />
                        </div>
                    </div>

                    @if (showAdvanced)
                    {
                        <div class="col-md-6">
                            <div class="mb-2">
                                <small class="text-muted">Primary Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.PrimaryColor" placeholder="#0066CC" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Secondary Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.SecondaryColor" placeholder="#005299" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Accent Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.AccentColor" placeholder="#003d7a" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Text Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.TextColor" placeholder="#212529" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Background:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.LightBgColor" placeholder="#f8f9fa" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Hero Badge Background:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.HeroBadgeColor" placeholder="#0056b3" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Button Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.ButtonColor" placeholder="#0066CC" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Surface Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.SurfaceColor" placeholder="#ffffff" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Surface Alt:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.SurfaceAltColor" placeholder="#f8f9fa" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Input Background:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.InputBgColor" placeholder="#ffffff" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Border Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.BorderColor" placeholder="#dee2e6" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Header/Footer Text Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.HeaderFooterTextColor" placeholder="#ffffff" />
                            </div>
                        </div>
                    }
                </div>

                }
                else
                {
                    <h6 class="mb-3">Dark Mode Palette</h6>

                <div class="row">
                    <div class="col-md-6">
                        <div class="color-input-wrapper">
                            <label for="darkPrimaryColor">Primary Color (Links/Highlights)</label>
                            <input type="color" class="color-input" id="darkPrimaryColor"
                                   @bind="colorSettings.DarkPrimaryColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkSecondaryColor">Secondary Color</label>
                            <input type="color" class="color-input" id="darkSecondaryColor"
                                   @bind="colorSettings.DarkSecondaryColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkAccentColor">Accent Color</label>
                            <input type="color" class="color-input" id="darkAccentColor"
                                   @bind="colorSettings.DarkAccentColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkTextColor">Text Color</label>
                            <input type="color" class="color-input" id="darkTextColor"
                                   @bind="colorSettings.DarkTextColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkBgColor">Background Color</label>
                            <input type="color" class="color-input" id="darkBgColor"
                                   @bind="colorSettings.DarkBgColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkHeroBadgeColor">Hero Badge Background</label>
                            <input type="color" class="color-input" id="darkHeroBadgeColor"
                                   @bind="colorSettings.DarkHeroBadgeColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkButtonColor">Button Color</label>
                            <input type="color" class="color-input" id="darkButtonColor"
                                   @bind="colorSettings.DarkButtonColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkSurfaceColor">Surface Color (Cards/Modals)</label>
                            <input type="color" class="color-input" id="darkSurfaceColor"
                                   @bind="colorSettings.DarkSurfaceColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkSurfaceAltColor">Surface Alt (Headers/Footers)</label>
                            <input type="color" class="color-input" id="darkSurfaceAltColor"
                                   @bind="colorSettings.DarkSurfaceAltColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkInputBgColor">Input Background</label>
                            <input type="color" class="color-input" id="darkInputBgColor"
                                   @bind="colorSettings.DarkInputBgColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkBorderColor">Border Color</label>
                            <input type="color" class="color-input" id="darkBorderColor"
                                   @bind="colorSettings.DarkBorderColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="darkHeaderFooterTextColor">Header/Footer Text Color</label>
                            <input type="color" class="color-input" id="darkHeaderFooterTextColor"
                                   @bind="colorSettings.DarkHeaderFooterTextColor" />
                        </div>
                    </div>

                    @if (showAdvanced)
                    {
                        <div class="col-md-6">
                            <div class="mb-2">
                                <small class="text-muted">Primary Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkPrimaryColor" placeholder="#569cd6" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Secondary Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkSecondaryColor" placeholder="#4f8cc4" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Accent Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkAccentColor" placeholder="#9cdcfe" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Text Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkTextColor" placeholder="#d4d4d4" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Background:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkBgColor" placeholder="#1e1e1e" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Hero Badge Background:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkHeroBadgeColor" placeholder="#2d2d30" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Button Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkButtonColor" placeholder="#569cd6" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Surface Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkSurfaceColor" placeholder="#252526" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Surface Alt:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkSurfaceAltColor" placeholder="#2d2d30" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Input Background:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkInputBgColor" placeholder="#3c3c3c" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Border Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkBorderColor" placeholder="#3e3e42" />
                            </div>

                            <div class="mb-2">
                                <small class="text-muted">Header/Footer Text Color:</small>
                                <input type="text" class="form-control form-control-sm"
                                       @bind="colorSettings.DarkHeaderFooterTextColor" placeholder="#ffffff" />
                            </div>
                        </div>
                    }
                </div>

                }

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="fas fa-save me-2"></i>Save Colors
                    </button>
                    <button type="button" class="btn btn-secondary" @onclick="ResetColors">
                        <i class="fas fa-undo me-2"></i>Reset to Defaults
                    </button>
                </div>

                @if (!string.IsNullOrEmpty(colorMessage))
                {
                    <div class="alert alert-success mt-3" role="alert">
                        @colorMessage
                    </div>
                }
            </form>

            <div class="preview-section mt-5">
                <h6 class="mb-3"><i class="fas fa-eye me-2"></i>Live Preview</h6>
                
                <p class="mb-2"><small class="text-muted">Your site will update with these colors immediately:</small></p>

                <div class="theme-preview" style="@GetPreviewCssVars()">
                    <div class="min-vh-100 d-flex flex-column">
                        <header class="navbar navbar-expand-lg navbar-dark w-100" style="background-color: var(--primary-color); padding: 0.5rem 1rem;">
                            <a class="navbar-brand flex-shrink-0" href="javascript:void(0)">NE Plumbing Inc.</a>

                            <div class="d-flex navbar-nav-center ms-3">
                                <a class="nav-link text-white me-3" href="javascript:void(0)">
                                    <span class="oi oi-home" aria-hidden="true"></span> Home
                                </a>
                                <a class="nav-link text-white me-3" href="javascript:void(0)">
                                    <span class="oi oi-plus" aria-hidden="true"></span> Services
                                </a>
                            </div>

                            <div class="d-flex navbar-controls ms-auto">
                                <button class="dark-mode-toggle" type="button" onclick="window.ToggleDarkMode && window.ToggleDarkMode()" title="Toggle dark mode">
                                    <i class="fas fa-moon dark-mode-icon-moon" aria-hidden="true"></i>
                                    <i class="fas fa-sun dark-mode-icon-sun" aria-hidden="true"></i>
                                </button>

                                <div class="d-flex align-items-center gap-2">
                                    <a class="nav-link text-white" href="javascript:void(0)">
                                        <span class="oi oi-account-logout" aria-hidden="true"></span> Admin dashboard
                                    </a>
                                    <a class="nav-link text-white" href="javascript:void(0)">
                                        <span class="oi oi-account-logout" aria-hidden="true"></span> Logout
                                    </a>
                                </div>
                            </div>
                        </header>

                        <main class="container my-4 flex-grow-1">
                            <div class="card">
                                <div class="card-body">
                                    <strong>Headline</strong>
                                    <span class="preview-badge">Hero Badge</span>
                                    <p class="mt-2 mb-2">
                                        Preview text and a <a class="preview-link" href="javascript:void(0)">link</a>.
                                    </p>
                                    <div class="d-flex flex-wrap gap-2">
                                        <button type="button" class="btn btn-primary btn-sm">Primary</button>
                                        <button type="button" class="btn btn-outline-primary btn-sm">Outline</button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm">Secondary</button>
                                    </div>
                                </div>
                            </div>

                            <div class="card mt-3">
                                <div class="card-body">
                                    <label class="form-label">Sample input</label>
                                    <input class="form-control" placeholder="Type here..." />
                                </div>
                            </div>
                        </main>

                        <footer class="text-white py-4 mt-auto" style="background-color: var(--primary-color);">
                            <div class="container">
                                <div class="row text-center text-md-start">
                                    <div class="col-md-4 mb-3">
                                        <h5>About Us</h5>
                                        <p class="mb-0">NE Plumbing Inc. brings 20+ years of experience in residential, commercial, and luxury plumbing. We’re proud to serve all of Utah with expert service and professionalism.</p>
                                    </div>

                                    @if (careersSettings?.IsHiringEnabled ?? true)
                                    {
                                        <div class="col-md-4 mb-3">
                                            <h5>Now Hiring</h5>
                                            <p class="mb-1">We're looking for skilled plumbers to join our team!</p>
                                            <a href="javascript:void(0)" class="btn btn-outline-light btn-sm">Apply Now</a>
                                        </div>
                                    }

                                    <div class="col-md-4 mb-3">
                                        <h5>Connect With Us</h5>

                                        <p class="mb-1">
                                            <a href="javascript:void(0)" class="text-white text-decoration-none">
                                                <i class="fab fa-instagram fa-lg me-2"></i>Instagram
                                            </a>
                                        </p>

                                        <p class="mb-1">
                                            <a href="javascript:void(0)" class="text-white text-decoration-none">
                                                <i class="fas fa-phone fa-sm me-2"></i>(801) 641-3246
                                            </a>
                                        </p>

                                        <p class="mb-0">
                                            <a href="javascript:void(0)" class="text-white text-decoration-none">
                                                <i class="fas fa-envelope fa-sm me-2"></i>neplumbinginc@gmail.com
                                            </a>
                                        </p>

                                        <p class="mt-3">
                                            <a href="javascript:void(0)" class="btn btn-outline-light btn-sm">Contact Us</a>
                                        </p>
                                    </div>
                                </div>

                                <hr class="border-secondary" />

                                <div class="text-center small">
                                    &copy; @(DateTime.Now.Year) NE Plumbing Inc. All rights reserved.
                                </div>
                            </div>
                        </footer>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="card shadow-sm">
        <div class="card-body">
            <p class="text-muted">Loading color settings...</p>
        </div>
    </div>
}

@code {
    private ColorSettings? colorSettings;
    private CareersPageSettings? careersSettings;
    private string fontMessage = "";
    private string colorMessage = "";
    private CancellationTokenSource? clearMessageCts;
    private string activePalette = "light";
    private bool showAdvanced;

    private bool? isFontLoaded;

    private string selectedPresetId = "default";

    private void SetLightPalette() => activePalette = "light";
    private void SetDarkPalette() => activePalette = "dark";

    private sealed record ThemePreset(
        string Id,
        string Name,
        string Primary,
        string Secondary,
        string Accent,
        string Text,
        string Background,
        string HeroBadge,
        string Button,
        string Surface,
        string SurfaceAlt,
        string InputBg,
        string Border,
        string HeaderFooterText,
        string FontFamily);

    private IReadOnlyList<ThemePreset> GetPresetsForActivePalette()
    {
        if (activePalette == "light")
        {
            return new List<ThemePreset>
            {
                new(
                    "default",
                    "Default (NE Plumbing)",
                    "#0066CC",
                    "#005299",
                    "#003d7a",
                    "#212529",
                    "#f8f9fa",
                    "#0056b3",
                    "#0066CC",
                    "#ffffff",
                    "#f8f9fa",
                    "#ffffff",
                    "#dee2e6",
                    "#ffffff",
                    "Inter"),
                new(
                    "neutral",
                    "Neutral (clean + minimal)",
                    "#0d6efd",
                    "#6c757d",
                    "#0d6efd",
                    "#212529",
                    "#f8f9fa",
                    "#0d6efd",
                    "#0d6efd",
                    "#ffffff",
                    "#f8f9fa",
                    "#ffffff",
                    "#dee2e6",
                    "#ffffff",
                    "Manrope"),
            };
        }

        return new List<ThemePreset>
        {
            new(
                "default",
                "Default Dark (VS-style)",
                "#569cd6",
                "#4f8cc4",
                "#9cdcfe",
                "#d4d4d4",
                "#1e1e1e",
                "#2d2d30",
                "#569cd6",
                "#252526",
                "#2d2d30",
                "#3c3c3c",
                "#3e3e42",
                "#ffffff",
                "Inter"),
            new(
                "oled",
                "OLED Dark (deeper blacks)",
                "#6cb6ff",
                "#8b949e",
                "#6cb6ff",
                "#e6edf3",
                "#0d1117",
                "#161b22",
                "#6cb6ff",
                "#161b22",
                "#0d1117",
                "#0d1117",
                "#30363d",
                "#ffffff",
                "Plus Jakarta Sans"),
        };
    }

    private void ApplySelectedPreset()
    {
        if (colorSettings is null)
        {
            return;
        }

        var preset = GetPresetsForActivePalette().FirstOrDefault(p => p.Id == selectedPresetId)
            ?? GetPresetsForActivePalette().First();

        colorSettings.FontFamily = preset.FontFamily;

        if (activePalette == "light")
        {
            colorSettings.PrimaryColor = preset.Primary;
            colorSettings.SecondaryColor = preset.Secondary;
            colorSettings.AccentColor = preset.Accent;
            colorSettings.TextColor = preset.Text;
            colorSettings.LightBgColor = preset.Background;
            colorSettings.HeroBadgeColor = preset.HeroBadge;
            colorSettings.ButtonColor = preset.Button;
            colorSettings.SurfaceColor = preset.Surface;
            colorSettings.SurfaceAltColor = preset.SurfaceAlt;
            colorSettings.InputBgColor = preset.InputBg;
            colorSettings.BorderColor = preset.Border;
            colorSettings.HeaderFooterTextColor = preset.HeaderFooterText;
        }
        else
        {
            colorSettings.DarkPrimaryColor = preset.Primary;
            colorSettings.DarkSecondaryColor = preset.Secondary;
            colorSettings.DarkAccentColor = preset.Accent;
            colorSettings.DarkTextColor = preset.Text;
            colorSettings.DarkBgColor = preset.Background;
            colorSettings.DarkHeroBadgeColor = preset.HeroBadge;
            colorSettings.DarkButtonColor = preset.Button;
            colorSettings.DarkSurfaceColor = preset.Surface;
            colorSettings.DarkSurfaceAltColor = preset.SurfaceAlt;
            colorSettings.DarkInputBgColor = preset.InputBg;
            colorSettings.DarkBorderColor = preset.Border;
            colorSettings.DarkHeaderFooterTextColor = preset.HeaderFooterText;
        }
    }

    private string GetPreviewCssVars()
    {
        if (colorSettings is null)
        {
            return string.Empty;
        }

        var fontCssValue = GetFontCssValue(colorSettings.FontFamily);

        if (activePalette == "light")
        {
            return $"--primary-color:{colorSettings.PrimaryColor};" +
                   $"--secondary-color:{colorSettings.SecondaryColor};" +
                   $"--accent-color:{colorSettings.AccentColor};" +
                   $"--text-color:{colorSettings.TextColor};" +
                   $"--page-bg-color:{colorSettings.LightBgColor};" +
                   $"--hero-badge-color:{colorSettings.HeroBadgeColor};" +
                   $"--button-color:{colorSettings.ButtonColor};" +
                   $"--surface-color:{colorSettings.SurfaceColor};" +
                   $"--surface-alt-color:{colorSettings.SurfaceAltColor};" +
                   $"--input-bg-color:{colorSettings.InputBgColor};" +
                   $"--bs-border-color:{colorSettings.BorderColor};" +
                                        $"--header-footer-text-color:{colorSettings.HeaderFooterTextColor};" +
                                        $"--site-font-family:{fontCssValue};" +
                   $"--bs-link-color:{colorSettings.PrimaryColor};" +
                   $"--bs-link-hover-color:{colorSettings.AccentColor};";
        }

        return $"--primary-color:{colorSettings.DarkPrimaryColor};" +
               $"--secondary-color:{colorSettings.DarkSecondaryColor};" +
               $"--accent-color:{colorSettings.DarkAccentColor};" +
               $"--text-color:{colorSettings.DarkTextColor};" +
               $"--page-bg-color:{colorSettings.DarkBgColor};" +
               $"--hero-badge-color:{colorSettings.DarkHeroBadgeColor};" +
               $"--button-color:{colorSettings.DarkButtonColor};" +
               $"--surface-color:{colorSettings.DarkSurfaceColor};" +
               $"--surface-alt-color:{colorSettings.DarkSurfaceAltColor};" +
               $"--input-bg-color:{colorSettings.DarkInputBgColor};" +
               $"--bs-border-color:{colorSettings.DarkBorderColor};" +
               $"--header-footer-text-color:{colorSettings.DarkHeaderFooterTextColor};" +
               $"--site-font-family:{fontCssValue};" +
               $"--bs-link-color:{colorSettings.DarkPrimaryColor};" +
               $"--bs-link-hover-color:{colorSettings.DarkAccentColor};";
    }

    private static string GetFontCssValue(string? fontFamily)
    {
        return (fontFamily ?? "Inter") switch
        {
            "Inter" => "'Inter'",
            "Manrope" => "'Manrope'",
            "Nunito Sans" => "'Nunito Sans'",
            "Plus Jakarta Sans" => "'Plus Jakarta Sans'",
            "Poppins" => "'Poppins'",
            "Montserrat" => "'Montserrat'",
            "Merriweather" => "'Merriweather'",
            "Roboto Slab" => "'Roboto Slab'",
            "Raleway" => "'Raleway'",
            "DM Sans" => "'DM Sans'",
            "Rubik" => "'Rubik'",
            "Work Sans" => "'Work Sans'",
            "Figtree" => "'Figtree'",
            "Oswald" => "'Oswald'",
            "Quicksand" => "'Quicksand'",
            "Space Grotesk" => "'Space Grotesk'",
            "Playfair Display" => "'Playfair Display'",
            "Lora" => "'Lora'",
            _ => "'Inter'",
        };
    }

    private string GetAdminFontStyle()
    {
        var fontCssValue = GetFontCssValue(colorSettings?.FontFamily);
        return $"font-family: {fontCssValue}, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;";
    }

    protected override async Task OnInitializedAsync()
    {
        colorSettings = await ColorSettingsService.GetColorSettingsAsync();
        careersSettings = await CareersPageSettingsService.GetSettingsAsync();

        await ApplyFontToPageAsync();
        await UpdateFontLoadedStatusAsync();
    }

    private async Task OnFontChangedAsync()
    {
        await ApplyFontToPageAsync();
        await UpdateFontLoadedStatusAsync();
    }

    private async Task ApplyFontToPageAsync()
    {
        if (colorSettings is null)
        {
            return;
        }

        var cssValue = GetFontCssValue(colorSettings.FontFamily);
        await JS.InvokeVoidAsync("nepFonts.setActiveFont", cssValue);
    }

    private async Task UpdateFontLoadedStatusAsync()
    {
        if (colorSettings is null)
        {
            isFontLoaded = null;
            return;
        }

        var cssValue = GetFontCssValue(colorSettings.FontFamily);

        // JS expects a CSS font-family token like: 'Inter'
        isFontLoaded = await JS.InvokeAsync<bool?>("nepFonts.isLoaded", cssValue);
    }

    private async Task SaveColors()
    {
        if (colorSettings != null)
        {
            try
            {
                await ColorSettingsService.UpdateColorSettingsAsync(colorSettings);
                colorMessage = "Colors updated successfully! Refresh the page to see the changes everywhere.";
                ScheduleClearMessage(TimeSpan.FromSeconds(5));
            }
            catch (Exception ex)
            {
                colorMessage = $"Error saving colors: {ex.Message}";
            }
        }
    }

    private async Task SaveFont()
    {
        if (colorSettings is null)
        {
            return;
        }

        try
        {
            await ColorSettingsService.UpdateFontFamilyAsync(colorSettings.FontFamily);
            fontMessage = "Font updated successfully! Refresh the page to see the changes everywhere.";
            ScheduleClearMessage(TimeSpan.FromSeconds(5));
        }
        catch (Exception ex)
        {
            fontMessage = $"Error saving font: {ex.Message}";
        }
    }

    private async Task ResetColors()
    {
        try
        {
            await ColorSettingsService.ResetToDefaultAsync();
            colorSettings = await ColorSettingsService.GetColorSettingsAsync();
            colorMessage = "Colors reset to defaults! Refresh the page to see the changes.";
            ScheduleClearMessage(TimeSpan.FromSeconds(5));
        }
        catch (Exception ex)
        {
            colorMessage = $"Error resetting colors: {ex.Message}";
        }
    }

    private void ScheduleClearMessage(TimeSpan delay)
    {
        clearMessageCts?.Cancel();
        clearMessageCts?.Dispose();
        clearMessageCts = new CancellationTokenSource();

        var token = clearMessageCts.Token;
        _ = ClearMessageAfterDelayAsync(delay, token);
    }

    private async Task ClearMessageAfterDelayAsync(TimeSpan delay, CancellationToken cancellationToken)
    {
        try
        {
            await Task.Delay(delay, cancellationToken);
        }
        catch (TaskCanceledException)
        {
            return;
        }

        fontMessage = "";
        colorMessage = "";
        await InvokeAsync(StateHasChanged);
    }
}
