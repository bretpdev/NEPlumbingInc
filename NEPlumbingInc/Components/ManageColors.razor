@inject IColorSettingsService ColorSettingsService
@rendermode InteractiveServer

<style>
    .color-picker-group {
        display: flex;
        align-items: flex-end;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .color-input-wrapper {
        flex: 1;
    }

    .color-input-wrapper label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .color-input {
        width: 100%;
        height: 50px;
        border: 2px solid #dee2e6;
        border-radius: 0.375rem;
        cursor: pointer;
    }

    .color-input:hover {
        border-color: #0066CC;
    }

    .color-preview {
        display: inline-block;
        width: 40px;
        height: 40px;
        border-radius: 0.375rem;
        border: 2px solid #dee2e6;
        margin-left: 0.5rem;
    }

    .preview-section {
        margin-top: 2rem;
        padding: 2rem;
        border-radius: 0.5rem;
        background-color: #f8f9fa;
    }

    .preview-section[data-dark-mode="true"] {
        background-color: #2a2a2a;
    }

    .preview-btn {
        padding: 0.5rem 1rem;
        margin: 0.5rem;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        font-weight: 500;
    }

    .preview-card {
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 0.375rem;
        border: 1px solid #dee2e6;
        background-color: white;
    }

    .preview-card[data-dark-mode="true"] {
        background-color: #3a3a3a;
        border-color: #555;
    }
</style>

<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="fas fa-palette me-2"></i>Manage Site Colors</h5>
    </div>
    <div class="card-body">
        @if (colorSettings != null)
        {
            <form @onsubmit="SaveColors" @onsubmit:preventDefault="true">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-3">Color Palette</h6>
                        
                        <div class="color-input-wrapper">
                            <label for="primaryColor">Primary Color (Navbar/Footer)</label>
                            <input type="color" class="color-input" id="primaryColor" 
                                   @bind="colorSettings.PrimaryColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="secondaryColor">Secondary Color</label>
                            <input type="color" class="color-input" id="secondaryColor" 
                                   @bind="colorSettings.SecondaryColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="accentColor">Accent Color</label>
                            <input type="color" class="color-input" id="accentColor" 
                                   @bind="colorSettings.AccentColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="textColor">Text Color</label>
                            <input type="color" class="color-input" id="textColor" 
                                   @bind="colorSettings.TextColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="bgColor">Light Background Color</label>
                            <input type="color" class="color-input" id="bgColor" 
                                   @bind="colorSettings.LightBgColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="heroBadgeColor">Hero Badge Background</label>
                            <input type="color" class="color-input" id="heroBadgeColor" 
                                   @bind="colorSettings.HeroBadgeColor" />
                        </div>

                        <div class="color-input-wrapper">
                            <label for="buttonColor">Button Color</label>
                            <input type="color" class="color-input" id="buttonColor" 
                                   @bind="colorSettings.ButtonColor" />
                        </div>
                    </div>

                    <div class="col-md-6">
                        <h6 class="mb-3">Color Codes (Hex)</h6>
                        
                        <div class="mb-2">
                            <small class="text-muted">Primary Color:</small>
                            <input type="text" class="form-control form-control-sm" 
                                   @bind="colorSettings.PrimaryColor" placeholder="#0066CC" />
                        </div>

                        <div class="mb-2">
                            <small class="text-muted">Secondary Color:</small>
                            <input type="text" class="form-control form-control-sm" 
                                   @bind="colorSettings.SecondaryColor" placeholder="#005299" />
                        </div>

                        <div class="mb-2">
                            <small class="text-muted">Accent Color:</small>
                            <input type="text" class="form-control form-control-sm" 
                                   @bind="colorSettings.AccentColor" placeholder="#003d7a" />
                        </div>

                        <div class="mb-2">
                            <small class="text-muted">Text Color:</small>
                            <input type="text" class="form-control form-control-sm" 
                                   @bind="colorSettings.TextColor" placeholder="#212529" />
                        </div>

                        <div class="mb-2">
                            <small class="text-muted">Light Background:</small>
                            <input type="text" class="form-control form-control-sm" 
                                   @bind="colorSettings.LightBgColor" placeholder="#f8f9fa" />
                        </div>

                        <div class="mb-2">
                            <small class="text-muted">Hero Badge Background:</small>
                            <input type="text" class="form-control form-control-sm" 
                                   @bind="colorSettings.HeroBadgeColor" placeholder="#0056b3" />
                        </div>

                        <div class="mb-2">
                            <small class="text-muted">Button Color:</small>
                            <input type="text" class="form-control form-control-sm" 
                                   @bind="colorSettings.ButtonColor" placeholder="#0066CC" />
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="fas fa-save me-2"></i>Save Colors
                    </button>
                    <button type="button" class="btn btn-secondary" @onclick="ResetColors">
                        <i class="fas fa-undo me-2"></i>Reset to Defaults
                    </button>
                </div>

                @if (!string.IsNullOrEmpty(message))
                {
                    <div class="alert alert-success mt-3" role="alert">
                        @message
                    </div>
                }
            </form>

            <div class="preview-section mt-5">
                <h6 class="mb-3"><i class="fas fa-eye me-2"></i>Live Preview</h6>
                
                <p class="mb-2"><small class="text-muted">Your site will update with these colors immediately:</small></p>

                <div class="preview-card" style="background-color: @colorSettings.PrimaryColor; color: white; padding: 1rem;">
                    <strong>Sample Header (Primary Color)</strong>
                </div>

                <div class="preview-card">
                    <p>Regular text will use color: <code>@colorSettings.TextColor</code></p>
                    <span class="hero-badge" style="background-color: @colorSettings.HeroBadgeColor; color: white; padding: 0.5rem 1rem; border-radius: 2rem; display: inline-block;">
                        Hero Badge
                    </span>
                </div>

                <div class="preview-card">
                    <button class="btn btn-sm" style="background-color: @colorSettings.ButtonColor; color: white; border: none;">
                        Sample Button
                    </button>
                </div>

                <div class="preview-card" style="background-color: @colorSettings.LightBgColor;">
                    <p>Light background for cards and containers</p>
                </div>
            </div>
        }
        else
        {
            <p class="text-muted">Loading color settings...</p>
        }
    </div>
</div>

@code {
    private ColorSettings? colorSettings;
    private string message = "";

    protected override async Task OnInitializedAsync()
    {
        colorSettings = await ColorSettingsService.GetColorSettingsAsync();
    }

    private async Task SaveColors()
    {
        if (colorSettings != null)
        {
            try
            {
                await ColorSettingsService.UpdateColorSettingsAsync(colorSettings);
                message = "Colors updated successfully! Refresh the page to see the changes everywhere.";
                
                // Clear message after 5 seconds
                await Task.Delay(5000);
                message = "";
            }
            catch (Exception ex)
            {
                message = $"Error saving colors: {ex.Message}";
            }
        }
    }

    private async Task ResetColors()
    {
        try
        {
            await ColorSettingsService.ResetToDefaultAsync();
            colorSettings = await ColorSettingsService.GetColorSettingsAsync();
            message = "Colors reset to defaults! Refresh the page to see the changes.";
            
            // Clear message after 5 seconds
            await Task.Delay(5000);
            message = "";
        }
        catch (Exception ex)
        {
            message = $"Error resetting colors: {ex.Message}";
        }
    }
}
